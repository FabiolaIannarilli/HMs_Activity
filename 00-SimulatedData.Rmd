# Variability in activity patterns from camera-trap data {#var}

To illustrate how variability in site-to-site use can affect activity patterns from
camera-trap data, we simulated data under equation 1 explained in the main text and reported here:

$$
y_{it} \sim Bernoulli(p_{it})
$$

$$
logit(p_{it}) = \beta_0 + \beta_1*cos(\frac{2\pi t}{24} + (\theta_0 + \gamma_i)) + \beta_2*cos(\frac{2\pi t}{12} + (\theta_1 + \gamma_i)) + \tau_i
$$

$$
\tau_i \sim N(0,\sigma_\tau)
$$

$$
\gamma_i \sim N(0,\sigma_\gamma)
$$

We set the intercept $\beta_0$, and the two amplitudes $\beta_1$ and $\beta_2$ equal to -3, 1, and 0.7, respectively. We assign the values 3 and 2 to the common phaseshifts terms, $\theta_0$ and $\theta_1$, respectively. 

To create examples of *variability in frequency of site-use*, we set the random intercept $\tau_i$ as equal to 0 and +/- 0.5, 1.0, and 1.5, while keeping $\gamma_i = 0$. Similarly, to create example of *variability in timing of activity peak*, we set the random phaseshift $\gamma_i$ as equal to 0 and +/- 0.5, 1.0, and 1.5, while keeping $\tau_i = 0$. The resulting plots are reported below and in the main text (Figure 1A and 1B, resectively). In both plots, the dashed grey curves represents the different values (darker to lighter colors from lower to higher values) assigned to either $\tau_i$ and $\gamma_i$. 

We describe the process step by step. We first load the necessary libraries and set the parameters.

```{r setsim1}
#' Load libraries and set equations' parameters
library(tidyverse)
library(grid)
library(gridExtra)
wavelength = 24
b0 = -3
b1 = 1 
b2 = 0.7
theta0 = 3
theta1 = 2 
tau_i = gamma_i = seq(-1.5, 1.5, by = 0.5)
time <- seq(0, wavelength, wavelength/512)
```

We then create different activity pattern curves keeping all the parameters constant (with $\gamma_i = 0$) except for $\tau_i$,
which varies from -1.5 to 1.5 in increments of 0.5. We create the curves in logit scale but trasform them in the 
probability scale, for easiness in interpretation.

```{r vertical}
# creating the curves
p_df <- data.frame(p = c(
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[1]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[2]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[3]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[4]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[5]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[6]),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+theta0 + gamma_i[4]) + b2*cos(2*pi*time/(12)+theta0 + gamma_i[4]) + tau_i[7])
), time = rep(time, 7), 
mean = c(rep(rep("off", length(time)),3), rep("on", length(time)), rep(rep("off", length(time)),3)),
curvesID = as.factor(rep(1:7, each = length(time))),
curvesLeg = as.factor(rep(c("+/- 1.5 SD", "+/- 1 SD", "+/- 0.5 SD", "Conditional", "+/- 0.5 SD", "+/- 1 SD", "+/- 1.5 SD"), each = length(time)))
)

p_df2 <- p_df %>% select(p, time) %>% group_by(time) %>% 
  summarize(p = mean(p)) %>% 
  mutate(mean = "on", curvesID = as.factor(8),
         curvesLeg = as.factor("Marginal"))

p_df <- rbind(p_df, as.data.frame(p_df2))

pl_vert <- ggplot(p_df, aes(x = time, y = p, group = curvesID)) +
  geom_line(aes(color = curvesLeg, size = mean, linetype = mean)) +
  scale_color_manual(values = c("grey40", "grey60", "grey80", "red", "black")) +
  scale_size_manual(values = c(0.5, 1.5)) +
  scale_linetype_manual(values = c(2, 1, 2)) +
  coord_cartesian(ylim = c(-0.05, 0.40)) +
  #geom_path(data = data.frame(x = c(11.5, 9), y = c(0.005, 0.005)), aes(x = x, y = y), linejoin = "mitre") +
  labs(x = "Time of Day", y = "Activity Patterns", title = "A) Variability in frequency of site-use") +
  theme_minimal()+
  theme(legend.position = "none",
        axis.line = element_line(colour = 'black', linetype = 'solid'),
        axis.ticks.x = element_line(colour = 'black', linetype = 'solid'), #element_blank(), #
        axis.text.y = element_blank(), #element_text(size=8),
        axis.title=element_text(size=10,face="bold"),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank()) + 
  geom_segment(aes(x=12, y=min(p), xend=12, yend=min(p)-0.05), arrow=arrow(length= unit(0.5, "cm")), 
               size = 1, color = "orange", linejoin = "mitre") +
  geom_segment(aes(x=12, y=0.25+0.003, xend=12, yend=0.25+0.053), arrow=arrow(length= unit(0.5, "cm")), 
               size = 1, color = "orange", linejoin = "mitre")+
  scale_x_continuous(breaks=seq(0,24,length.out=7), labels=seq(0,24,4)) 



#' #### Phaseshift in unimodal --------------------------------------------------

p_df <- data.frame(p = c(
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift+0.5)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift+1)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift+1.5)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift-0.5)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift-1)),
  boot::inv.logit(b0 + b1*cos(2*pi*time/(24)+phaseshift-1.5))
), time = rep(time, 7), 
mean = c(rep("on", length(time)), rep(rep("off", length(time)),6)),
curvesID = as.factor(rep(1:7, each = length(time))),
curvesLeg = as.factor(rep(c("Conditional", "+/- 0.5 SD", "+/- 1 SD", "+/- 1.5 SD", "+/- 0.5 SD", "+/- 1 SD", "+/- 1.5 SD"), each = length(time))) 
)

p_df2 <- p_df %>% select(p, time) %>% group_by(time) %>% 
  summarize(p = mean(p)) %>% 
  mutate(mean = "on", curvesID = as.factor(8),
         curvesLeg = as.factor("Marginal"))

p_df <- rbind(p_df, as.data.frame(p_df2))

pl_hor <- ggplot(p_df, aes(x = time, y = p, group = curvesID)) +
  geom_line(aes(color = curvesLeg, size = curvesID, linetype = mean)) +
  scale_color_manual(values = c("grey40", "grey60", "grey80", "red", "black")) +
  scale_size_manual(values = c(1.5, rep(0.5, 6), 1.5)) +
  scale_linetype_manual(values = c(2, 1)) +
  coord_cartesian(ylim = c(0.006, 0.055)) +
  #geom_path(data = data.frame(x = c(11.5, 9), y = c(0.005, 0.005)), aes(x = x, y = y), linejoin = "mitre") +
  labs(x = "Time of Day", y = "Activity Patterns", title = "B) Variability in time of activity peak") +
  theme_minimal()+
  theme(legend.position = "none", 
        axis.line = element_line(colour = 'black', linetype = 'solid'),
        axis.ticks.x = element_line(colour = 'black', linetype = 'solid'),# element_blank(), 
        axis.text.y = element_blank(), #element_text(size=8),
        axis.title=element_text(size=10,face="bold"),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank()) +
  geom_segment(aes(x=13.64062-0.75, y=0.052, xend=13.64062-7, yend=0.052), arrow=arrow(length= unit(0.5, "cm")), 
               size = 1, color = "orange", linejoin = "mitre") +
  geom_segment(aes(x=13.64062+0.75, y=0.052, xend=13.64062+7, yend=0.052), arrow=arrow(length= unit(0.5, "cm")), 
               size = 1, color = "orange", linejoin = "mitre") +
  scale_x_continuous(breaks=seq(0,24,length.out=7), labels=seq(0,24,4))+
  guides(linetype=element_blank())





#' Join plots
pl <- grid.arrange(pl_vert, pl_hor, ncol = 2)
ggsave(pl, filename = "figures/Fig1_Site_Variability_in_Activity.jpg", device = "jpeg", units = "cm", width = 16, height = 8, dpi = 300)

```
