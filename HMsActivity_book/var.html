<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tutorial 2 Variability in activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</title>
  <meta name="description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript Iannarilli et al. 2024. Journal of Animal Ecology" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Tutorial 2 Variability in activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript Iannarilli et al. 2024. Journal of Animal Ecology" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tutorial 2 Variability in activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  
  <meta name="twitter:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript Iannarilli et al. 2024. Journal of Animal Ecology" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="est.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#structure-of-the-tutorial"><i class="fa fa-check"></i><b>1.1</b> Structure of the Tutorial</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.2</b> Requirements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="var.html"><a href="var.html"><i class="fa fa-check"></i><b>2</b> Variability in activity patterns</a>
<ul>
<li class="chapter" data-level="2.1" data-path="var.html"><a href="var.html#variability-in-frequency-of-site-use"><i class="fa fa-check"></i><b>2.1</b> Variability in frequency of site-use</a></li>
<li class="chapter" data-level="2.2" data-path="var.html"><a href="var.html#variability-in-timing-of-activity"><i class="fa fa-check"></i><b>2.2</b> Variability in timing of activity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="est.html"><a href="est.html"><i class="fa fa-check"></i><b>3</b> Estimating activity patterns from time-stamped data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="est.html"><a href="est.html#simulating-activity-patterns"><i class="fa fa-check"></i><b>3.1</b> Simulating activity patterns</a></li>
<li class="chapter" data-level="3.2" data-path="est.html"><a href="est.html#data-preparation"><i class="fa fa-check"></i><b>3.2</b> Data preparation</a></li>
<li class="chapter" data-level="3.3" data-path="est.html"><a href="est.html#trigonometric-glmms"><i class="fa fa-check"></i><b>3.3</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="3.4" data-path="est.html"><a href="est.html#cyclic-cubic-spline-hgams"><i class="fa fa-check"></i><b>3.4</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataprep.html"><a href="dataprep.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a></li>
<li class="chapter" data-level="5" data-path="unibim.html"><a href="unibim.html"><i class="fa fa-check"></i><b>5</b> Evaluating hypotheses regarding the shape of activity curves</a></li>
<li class="chapter" data-level="6" data-path="cov.html"><a href="cov.html"><i class="fa fa-check"></i><b>6</b> Modeling activity patterns with covariates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cov.html"><a href="cov.html#cat"><i class="fa fa-check"></i><b>6.1</b> Categorical covariates</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cov.html"><a href="cov.html#trigonometric-glmms-1"><i class="fa fa-check"></i><b>6.1.1</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="6.1.2" data-path="cov.html"><a href="cov.html#cyclic-cubic-spline-hgams-1"><i class="fa fa-check"></i><b>6.1.2</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cov.html"><a href="cov.html#cont"><i class="fa fa-check"></i><b>6.2</b> Continuous covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="temppart.html"><a href="temppart.html"><i class="fa fa-check"></i><b>7</b> Temporal partitioning</a></li>
<li class="chapter" data-level="8" data-path="condvsmarg.html"><a href="condvsmarg.html"><i class="fa fa-check"></i><b>8</b> Conditional and marginal mean activity patterns</a>
<ul>
<li class="chapter" data-level="8.1" data-path="condvsmarg.html"><a href="condvsmarg.html#estimating-conditional-and-marginal-mean-activity-patterns"><i class="fa fa-check"></i><b>8.1</b> Estimating conditional and marginal mean activity patterns</a></li>
<li class="chapter" data-level="8.2" data-path="condvsmarg.html"><a href="condvsmarg.html#the-frequentist-framework"><i class="fa fa-check"></i><b>8.2</b> The frequentist framework</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="kdes.html"><a href="kdes.html"><i class="fa fa-check"></i><b>9</b> Kernel Density Estimators</a>
<ul>
<li class="chapter" data-level="9.1" data-path="kdes.html"><a href="kdes.html#dataprepkdes"><i class="fa fa-check"></i><b>9.1</b> Data preparation for KDEs</a></li>
<li class="chapter" data-level="9.2" data-path="kdes.html"><a href="kdes.html#kdespkg"><i class="fa fa-check"></i><b>9.2</b> Comparison of KDE estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="kdes.html"><a href="kdes.html#using-the-overlap-package"><i class="fa fa-check"></i><b>9.2.1</b> Using the overlap package</a></li>
<li class="chapter" data-level="9.2.2" data-path="kdes.html"><a href="kdes.html#using-the-activity-package"><i class="fa fa-check"></i><b>9.2.2</b> Using the activity package</a></li>
<li class="chapter" data-level="9.2.3" data-path="kdes.html"><a href="kdes.html#using-the-circular-package"><i class="fa fa-check"></i><b>9.2.3</b> Using the circular package</a></li>
<li class="chapter" data-level="9.2.4" data-path="kdes.html"><a href="kdes.html#comparing-the-results-and-plotting"><i class="fa fa-check"></i><b>9.2.4</b> Comparing the results and plotting</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="kdes.html"><a href="kdes.html#kdedataaggr"><i class="fa fa-check"></i><b>9.3</b> Aggregating <em>versus</em> non-aggregating data in KDEs</a></li>
<li class="chapter" data-level="9.4" data-path="kdes.html"><a href="kdes.html#compkde"><i class="fa fa-check"></i><b>9.4</b> KDEs <em>versus</em> hierarchical models approaches</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="app.html"><a href="app.html"><i class="fa fa-check"></i><b>10</b> Appendix</a>
<ul>
<li class="chapter" data-level="10.1" data-path="app.html"><a href="app.html#simfunction"><i class="fa fa-check"></i><b>10.1</b> The <em>sim_activity</em> function</a></li>
<li class="chapter" data-level="10.2" data-path="app.html"><a href="app.html#poisson"><i class="fa fa-check"></i><b>10.2</b> Binomial versus other distributions</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="app.html"><a href="app.html#data-preparation-1"><i class="fa fa-check"></i><b>10.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.2.2" data-path="app.html"><a href="app.html#trigonometric-pdf-comparison"><i class="fa fa-check"></i><b>10.2.2</b> Trigonometric PDF comparison</a></li>
<li class="chapter" data-level="10.2.3" data-path="app.html"><a href="app.html#cyclic-cubic-pdf-comparison"><i class="fa fa-check"></i><b>10.2.3</b> Cyclic cubic PDF comparison</a></li>
<li class="chapter" data-level="10.2.4" data-path="app.html"><a href="app.html#not-controlling-for-sampling-effort"><i class="fa fa-check"></i><b>10.2.4</b> Not controlling for sampling effort</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="app.html"><a href="app.html#bay"><i class="fa fa-check"></i><b>10.3</b> Activity patterns in the Bayesian framework</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="app.html"><a href="app.html#data-preparation-2"><i class="fa fa-check"></i><b>10.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.3.2" data-path="app.html"><a href="app.html#model-setup-and-fitting"><i class="fa fa-check"></i><b>10.3.2</b> Model setup and fitting</a></li>
<li class="chapter" data-level="10.3.3" data-path="app.html"><a href="app.html#model-assessment"><i class="fa fa-check"></i><b>10.3.3</b> Model assessment</a></li>
<li class="chapter" data-level="10.3.4" data-path="app.html"><a href="app.html#model-predictions"><i class="fa fa-check"></i><b>10.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="app.html"><a href="app.html#DielNiche"><i class="fa fa-check"></i><b>10.4</b> Link to the Diel.Niche package</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="app.html"><a href="app.html#data"><i class="fa fa-check"></i><b>10.4.1</b> Data</a></li>
<li class="chapter" data-level="10.4.2" data-path="app.html"><a href="app.html#model-fitting"><i class="fa fa-check"></i><b>10.4.2</b> Model fitting</a></li>
<li class="chapter" data-level="10.4.3" data-path="app.html"><a href="app.html#model-predictions-1"><i class="fa fa-check"></i><b>10.4.3</b> Model predictions</a></li>
<li class="chapter" data-level="10.4.4" data-path="app.html"><a href="app.html#twilight-daytime-and-nighttime"><i class="fa fa-check"></i><b>10.4.4</b> Twilight, daytime, and nighttime</a></li>
<li class="chapter" data-level="10.4.5" data-path="app.html"><a href="app.html#diel.niche"><i class="fa fa-check"></i><b>10.4.5</b> Diel.Niche</a></li>
<li class="chapter" data-level="10.4.6" data-path="app.html"><a href="app.html#conclusion"><i class="fa fa-check"></i><b>10.4.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="app.html"><a href="app.html#info-session"><i class="fa fa-check"></i><b>10.5</b> Info session</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="var" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Tutorial 2</span> Variability in activity patterns<a href="var.html#var" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We begin the tutorial by illustrating how site-to-site variability can affect animals’ diel activity patterns. Site-to-site variability can be decomposed into two components:</p>
<p>1. variability in frequency of site-use and</p>
<p>2. variability in timing of activity.</p>
<p>Here, we illustrate these two components separately in the context of a bimodal activity pattern (i.e. a pattern in which an animal’s activity is concentrated at two times of the 24-hour cycle) first, and then in the context of a unimodal activity pattern (i.e. a pattern in which an animal’s activity is concentrated at one specific time within the 24-hour cycle). Real activity patterns are likely to exhibit both sources of variability, so, in Tutorial <a href="est.html#est">3</a>, we present an example in which we simulate activity patterns by simultaneously varying both the frequency of site-use and variability in timing of activity.</p>
<p>We simulated data under equation 1 explained in the main text (Materials and Results in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>) and reported here as:</p>
<p><span class="math display">\[
y_{it} \sim Bernoulli(p_{it})
\]</span></p>
<p><span class="math display">\[
\text{logit}(p_{it}) = \beta_0 + \beta_1*\text{cos}(\frac{2\pi t}{\omega_1} + (\theta_0 + \gamma_i)) + \beta_2*\text{cos}(\frac{2\pi t}{omega_1} + (\theta_1 + \gamma_i)) + \tau_i
\]</span></p>
<p><span class="math display">\[
\tau_i \sim N(0,\sigma_\tau)
\]</span></p>
<p><span class="math display">\[
\gamma_i \sim N(0,\sigma_\gamma)
\]</span></p>
<p>We load the necessary libraries and set the intercept <span class="math inline">\(\beta_0\)</span>, and the two amplitudes <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> equal to -3, 1, and 0.7, respectively. We also assign the values 3 and 2 to the common phaseshifts terms, <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span>, respectively, and set <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span> equal to 24 and 12, respectively.</p>
<p>The parameters <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\gamma_i\)</span> (and their associated distributions) control the level of variability in site-use (i.e. vertical shift among the activity curves) and timing of activity (i.e. horizontal shift among activity curves), respectively. For illustrative purposes, here we assign predefined values to <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\gamma_i\)</span>, and vary only one of them at a time.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="var.html#cb2-1" tabindex="-1"></a><span class="co"># Load libraries </span></span>
<span id="cb2-2"><a href="var.html#cb2-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb2-3"><a href="var.html#cb2-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">129</span>)</span>
<span id="cb2-4"><a href="var.html#cb2-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-5"><a href="var.html#cb2-5" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb2-6"><a href="var.html#cb2-6" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb2-7"><a href="var.html#cb2-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-8"><a href="var.html#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="var.html#cb2-9" tabindex="-1"></a><span class="co">#Set equation parameters</span></span>
<span id="cb2-10"><a href="var.html#cb2-10" tabindex="-1"></a>wavelength <span class="ot">=</span> <span class="dv">24</span></span>
<span id="cb2-11"><a href="var.html#cb2-11" tabindex="-1"></a>b0 <span class="ot">=</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb2-12"><a href="var.html#cb2-12" tabindex="-1"></a>b1 <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb2-13"><a href="var.html#cb2-13" tabindex="-1"></a>b2 <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb2-14"><a href="var.html#cb2-14" tabindex="-1"></a>theta0 <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb2-15"><a href="var.html#cb2-15" tabindex="-1"></a>theta1 <span class="ot">=</span> <span class="dv">2</span> </span>
<span id="cb2-16"><a href="var.html#cb2-16" tabindex="-1"></a>tau_i <span class="ot">=</span> gamma_i <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb2-17"><a href="var.html#cb2-17" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span></code></pre></div>
<div id="variability-in-frequency-of-site-use" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Variability in frequency of site-use<a href="var.html#variability-in-frequency-of-site-use" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To create examples of <em>variability in frequency of site-use</em>, we set <span class="math inline">\(\gamma_i = 0\)</span>, keep all the other parameters constant, and vary <span class="math inline">\(\tau_i\)</span> from -1.5 to 1.5 in increments of 0.5. We create the curves on the logit scale, based on equation 1, but then transform them back to the probability scale, for ease of interpretation.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="var.html#cb3-1" tabindex="-1"></a><span class="co"># create the curves</span></span>
<span id="cb3-2"><a href="var.html#cb3-2" tabindex="-1"></a>p_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb3-3"><a href="var.html#cb3-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb3-4"><a href="var.html#cb3-4" tabindex="-1"></a> p_df<span class="ot">&lt;-</span><span class="fu">rbind</span>(p_df, </span>
<span id="cb3-5"><a href="var.html#cb3-5" tabindex="-1"></a>   <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span>theta0 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span> </span>
<span id="cb3-6"><a href="var.html#cb3-6" tabindex="-1"></a>                         b2<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">12</span>)<span class="sc">+</span> theta1 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span> tau_i[i]</span>
<span id="cb3-7"><a href="var.html#cb3-7" tabindex="-1"></a>                         ),</span>
<span id="cb3-8"><a href="var.html#cb3-8" tabindex="-1"></a>             <span class="at">time =</span> time, </span>
<span id="cb3-9"><a href="var.html#cb3-9" tabindex="-1"></a>             <span class="at">curvesID =</span> <span class="fu">rep</span>(<span class="fu">as.factor</span>(i), <span class="fu">length</span>(time))</span>
<span id="cb3-10"><a href="var.html#cb3-10" tabindex="-1"></a>             )</span>
<span id="cb3-11"><a href="var.html#cb3-11" tabindex="-1"></a>   )</span>
<span id="cb3-12"><a href="var.html#cb3-12" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="var.html#cb3-13" tabindex="-1"></a>p_df<span class="sc">$</span>curvesLeg <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>, <span class="st">&quot;Conditional&quot;</span>, <span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>), </span>
<span id="cb3-14"><a href="var.html#cb3-14" tabindex="-1"></a>                               <span class="at">each =</span> <span class="fu">length</span>(time)</span>
<span id="cb3-15"><a href="var.html#cb3-15" tabindex="-1"></a>                               )</span>
<span id="cb3-16"><a href="var.html#cb3-16" tabindex="-1"></a>                           )</span>
<span id="cb3-17"><a href="var.html#cb3-17" tabindex="-1"></a>p_df<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>), </span>
<span id="cb3-18"><a href="var.html#cb3-18" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">&quot;on&quot;</span>, <span class="fu">length</span>(time)), </span>
<span id="cb3-19"><a href="var.html#cb3-19" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>)</span>
<span id="cb3-20"><a href="var.html#cb3-20" tabindex="-1"></a>               )</span></code></pre></div>
<p>We can then calculate the marginal mean by integrating over the distribution of the random effects.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="var.html#cb4-1" tabindex="-1"></a>p_marg <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(time), <span class="dv">1</span>)</span>
<span id="cb4-2"><a href="var.html#cb4-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(time)){</span>
<span id="cb4-3"><a href="var.html#cb4-3" tabindex="-1"></a>  intfun<span class="ot">&lt;-</span><span class="cf">function</span>(tau_x){</span>
<span id="cb4-4"><a href="var.html#cb4-4" tabindex="-1"></a>    <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">24</span>) <span class="sc">+</span> theta0 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb4-5"><a href="var.html#cb4-5" tabindex="-1"></a>           b2<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">12</span>) <span class="sc">+</span> theta1 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span> tau_x</span>
<span id="cb4-6"><a href="var.html#cb4-6" tabindex="-1"></a>           ) <span class="sc">*</span> <span class="fu">dnorm</span>(tau_x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="var.html#cb4-7" tabindex="-1"></a>  }</span>
<span id="cb4-8"><a href="var.html#cb4-8" tabindex="-1"></a>    p_marg[i]<span class="ot">&lt;-</span><span class="fu">integrate</span>(intfun,<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)[<span class="dv">1</span>]</span>
<span id="cb4-9"><a href="var.html#cb4-9" tabindex="-1"></a>}</span></code></pre></div>
<p>We discuss differences between conditional and marginal means in detail in Tutorial <a href="condvsmarg.html#condvsmarg">8</a> and in Box 1 in the main text <span class="citation">(<a href="references.html#ref-HMsActivity2024">Iannarilli et al. 2024</a>)</span>. Although we can consider conditional means for any site, it is often instructive to consider the conditional mean curve for a “typical site”, which is obtained by setting all the random effects equal to zero; it is this conditional mean we are referring to if we do not mention a specific site. We can plot the conditional and marginal curves using the code below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="var.html#cb5-1" tabindex="-1"></a><span class="co"># Combine dataframes for plotting</span></span>
<span id="cb5-2"><a href="var.html#cb5-2" tabindex="-1"></a>p_df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">unlist</span>(p_marg),</span>
<span id="cb5-3"><a href="var.html#cb5-3" tabindex="-1"></a>                    <span class="at">time =</span> time,</span>
<span id="cb5-4"><a href="var.html#cb5-4" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="st">&quot;on&quot;</span>, </span>
<span id="cb5-5"><a href="var.html#cb5-5" tabindex="-1"></a>                    <span class="at">curvesID =</span> <span class="fu">as.factor</span>(<span class="dv">8</span>),</span>
<span id="cb5-6"><a href="var.html#cb5-6" tabindex="-1"></a>                    <span class="at">curvesLeg =</span> <span class="fu">as.factor</span>(<span class="st">&quot;Marginal&quot;</span>)</span>
<span id="cb5-7"><a href="var.html#cb5-7" tabindex="-1"></a>                    )</span>
<span id="cb5-8"><a href="var.html#cb5-8" tabindex="-1"></a>p_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p_df, p_df2)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb6-1"><a href="var.html#cb6-1" tabindex="-1"></a><span class="co"># plot activity curves</span></span>
<span id="cb6-2"><a href="var.html#cb6-2" tabindex="-1"></a>(pl_vert <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(p_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p, <span class="at">group =</span> curvesID)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="var.html#cb6-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> curvesLeg, <span class="at">linewidth =</span> mean, <span class="at">linetype =</span> mean)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="var.html#cb6-4" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey40&quot;</span>, <span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="var.html#cb6-5" tabindex="-1"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="var.html#cb6-6" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="var.html#cb6-7" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">0.45</span>)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="var.html#cb6-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability of Activity&quot;</span>, <span class="at">title =</span> <span class="st">&quot;A) Variability in </span><span class="sc">\n</span><span class="st"> frequency of site-use&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="var.html#cb6-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb6-10"><a href="var.html#cb6-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb6-11"><a href="var.html#cb6-11" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb6-12"><a href="var.html#cb6-12" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>), <span class="co">#element_blank(), #</span></span>
<span id="cb6-13"><a href="var.html#cb6-13" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb6-14"><a href="var.html#cb6-14" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb6-15"><a href="var.html#cb6-15" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>,<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb6-16"><a href="var.html#cb6-16" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-17"><a href="var.html#cb6-17" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()</span>
<span id="cb6-18"><a href="var.html#cb6-18" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb6-19"><a href="var.html#cb6-19" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fu">min</span>(p), <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fu">min</span>(p)<span class="sc">-</span><span class="fl">0.05</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb6-20"><a href="var.html#cb6-20" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="var.html#cb6-21" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fl">0.35+0.003</span>, <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fl">0.35+0.053</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb6-22"><a href="var.html#cb6-22" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>)<span class="sc">+</span></span>
<span id="cb6-23"><a href="var.html#cb6-23" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>))</span>
<span id="cb6-24"><a href="var.html#cb6-24" tabindex="-1"></a> ) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sim2d"></span>
<img src="HMsActivity_files/figure-html/sim2d-1.png" alt="Probability activity curves across sites (dashed lines) along with the marginal mean curve (black line) and conditional mean curve (red line). " width="672" />
<p class="caption">
Figure 2.1: Probability activity curves across sites (dashed lines) along with the marginal mean curve (black line) and conditional mean curve (red line).
</p>
</div>
<p>In this first plot, the dashed grey curves represent the curves generated using the different values assigned to <span class="math inline">\(\tau_i\)</span> (darker to lighter colors from lower to higher in absolute values). All other things equal, these different values of <span class="math inline">\(\tau_i\)</span> lead to a vertical shift in the activity curves, which corresponds to a change in the frequency of site-use. The red curve gives the conditional mean for a “typical site” (estimated by setting <span class="math inline">\(\tau_i = 0\)</span> and <span class="math inline">\(\gamma_i = 0\)</span> in equation 1), and the black curve gives the marginal mean.</p>
</div>
<div id="variability-in-timing-of-activity" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Variability in timing of activity<a href="var.html#variability-in-timing-of-activity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To create examples of <em>variability in timing of activity</em>, we set the random phaseshift <span class="math inline">\(\gamma_i\)</span> as equal to 0, <span class="math inline">\(\pm\)</span> 0.5, <span class="math inline">\(\pm\)</span> 1.0, and <span class="math inline">\(\pm\)</span> 1.5, while keeping <span class="math inline">\(\tau_i = 0\)</span> and the remaining parameters with the same values used before. We create and plot the curves, then join the two plots to create the first portion of Figure 1, reported in the main text <span class="citation">(<a href="references.html#ref-HMsActivity2024">Iannarilli et al. 2024</a>)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="var.html#cb7-1" tabindex="-1"></a><span class="co"># create the curves</span></span>
<span id="cb7-2"><a href="var.html#cb7-2" tabindex="-1"></a>p_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb7-3"><a href="var.html#cb7-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb7-4"><a href="var.html#cb7-4" tabindex="-1"></a> p_df<span class="ot">&lt;-</span><span class="fu">rbind</span>(p_df, </span>
<span id="cb7-5"><a href="var.html#cb7-5" tabindex="-1"></a>             <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span>theta0 <span class="sc">+</span> gamma_i[i]) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="var.html#cb7-6" tabindex="-1"></a>                                   b2<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">12</span>)<span class="sc">+</span> theta1 <span class="sc">+</span> gamma_i[i]) <span class="sc">+</span> tau_i[<span class="dv">4</span>]</span>
<span id="cb7-7"><a href="var.html#cb7-7" tabindex="-1"></a>                                   ),</span>
<span id="cb7-8"><a href="var.html#cb7-8" tabindex="-1"></a>                        <span class="at">time =</span> time, </span>
<span id="cb7-9"><a href="var.html#cb7-9" tabindex="-1"></a>                        <span class="at">curvesID =</span> <span class="fu">rep</span>(<span class="fu">as.factor</span>(i), <span class="fu">length</span>(time))</span>
<span id="cb7-10"><a href="var.html#cb7-10" tabindex="-1"></a>                        )</span>
<span id="cb7-11"><a href="var.html#cb7-11" tabindex="-1"></a>            )</span>
<span id="cb7-12"><a href="var.html#cb7-12" tabindex="-1"></a>}</span>
<span id="cb7-13"><a href="var.html#cb7-13" tabindex="-1"></a>p_df<span class="sc">$</span>curvesLeg <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>, <span class="st">&quot;Conditional&quot;</span>, <span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>), </span>
<span id="cb7-14"><a href="var.html#cb7-14" tabindex="-1"></a>                               <span class="at">each =</span> <span class="fu">length</span>(time)</span>
<span id="cb7-15"><a href="var.html#cb7-15" tabindex="-1"></a>                               )</span>
<span id="cb7-16"><a href="var.html#cb7-16" tabindex="-1"></a>                           )</span>
<span id="cb7-17"><a href="var.html#cb7-17" tabindex="-1"></a>p_df<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>), </span>
<span id="cb7-18"><a href="var.html#cb7-18" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">&quot;on&quot;</span>, <span class="fu">length</span>(time)), </span>
<span id="cb7-19"><a href="var.html#cb7-19" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>)</span>
<span id="cb7-20"><a href="var.html#cb7-20" tabindex="-1"></a>               )</span>
<span id="cb7-21"><a href="var.html#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="var.html#cb7-22" tabindex="-1"></a><span class="co"># calculate the marginal mean activity curve by integrating over the distribution of the random effects</span></span>
<span id="cb7-23"><a href="var.html#cb7-23" tabindex="-1"></a>p_marg <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(time), <span class="dv">1</span>)</span>
<span id="cb7-24"><a href="var.html#cb7-24" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(time)){</span>
<span id="cb7-25"><a href="var.html#cb7-25" tabindex="-1"></a>  intfun<span class="ot">&lt;-</span><span class="cf">function</span>(gamma_x){</span>
<span id="cb7-26"><a href="var.html#cb7-26" tabindex="-1"></a>     <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span> theta0 <span class="sc">+</span> gamma_x) <span class="sc">+</span></span>
<span id="cb7-27"><a href="var.html#cb7-27" tabindex="-1"></a>            b2<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">12</span>)<span class="sc">+</span>theta1 <span class="sc">+</span> gamma_x) <span class="sc">+</span> tau_i[<span class="dv">4</span>]</span>
<span id="cb7-28"><a href="var.html#cb7-28" tabindex="-1"></a>            ) <span class="sc">*</span><span class="fu">dnorm</span>(gamma_x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb7-29"><a href="var.html#cb7-29" tabindex="-1"></a>       }</span>
<span id="cb7-30"><a href="var.html#cb7-30" tabindex="-1"></a>       p_marg[i]<span class="ot">&lt;-</span><span class="fu">integrate</span>(intfun,<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)[<span class="dv">1</span>]</span>
<span id="cb7-31"><a href="var.html#cb7-31" tabindex="-1"></a>}</span>
<span id="cb7-32"><a href="var.html#cb7-32" tabindex="-1"></a>p_df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">unlist</span>(p_marg),</span>
<span id="cb7-33"><a href="var.html#cb7-33" tabindex="-1"></a>                    <span class="at">time =</span> time,</span>
<span id="cb7-34"><a href="var.html#cb7-34" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="st">&quot;on&quot;</span>, </span>
<span id="cb7-35"><a href="var.html#cb7-35" tabindex="-1"></a>                    <span class="at">curvesID =</span> <span class="fu">as.factor</span>(<span class="dv">8</span>),</span>
<span id="cb7-36"><a href="var.html#cb7-36" tabindex="-1"></a>                    <span class="at">curvesLeg =</span> <span class="fu">as.factor</span>(<span class="st">&quot;Marginal&quot;</span>)</span>
<span id="cb7-37"><a href="var.html#cb7-37" tabindex="-1"></a>                    )</span>
<span id="cb7-38"><a href="var.html#cb7-38" tabindex="-1"></a>p_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p_df, p_df2)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb8-1"><a href="var.html#cb8-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb8-2"><a href="var.html#cb8-2" tabindex="-1"></a>pl_hor <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(p_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p, <span class="at">group =</span> curvesID)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="var.html#cb8-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> curvesLeg, <span class="at">linewidth =</span> mean, <span class="at">linetype =</span> mean)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="var.html#cb8-4" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey40&quot;</span>, <span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="var.html#cb8-5" tabindex="-1"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb8-6"><a href="var.html#cb8-6" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="var.html#cb8-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability of Activity&quot;</span>, <span class="at">title =</span> <span class="st">&quot;B) Variability in </span><span class="sc">\n</span><span class="st"> timing of activity&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="var.html#cb8-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb8-9"><a href="var.html#cb8-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb8-10"><a href="var.html#cb8-10" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb8-11"><a href="var.html#cb8-11" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>), </span>
<span id="cb8-12"><a href="var.html#cb8-12" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb8-13"><a href="var.html#cb8-13" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb8-14"><a href="var.html#cb8-14" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb8-15"><a href="var.html#cb8-15" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-16"><a href="var.html#cb8-16" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()</span>
<span id="cb8-17"><a href="var.html#cb8-17" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb8-18"><a href="var.html#cb8-18" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span> <span class="sc">-</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="dv">12</span> <span class="sc">-</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb8-19"><a href="var.html#cb8-19" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-20"><a href="var.html#cb8-20" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span> <span class="sc">+</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="dv">12</span> <span class="sc">+</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb8-21"><a href="var.html#cb8-21" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-22"><a href="var.html#cb8-22" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>))<span class="sc">+</span></span>
<span id="cb8-23"><a href="var.html#cb8-23" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linetype=</span><span class="fu">element_blank</span>())</span>
<span id="cb8-24"><a href="var.html#cb8-24" tabindex="-1"></a></span>
<span id="cb8-25"><a href="var.html#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="var.html#cb8-26" tabindex="-1"></a><span class="co"># Join plots</span></span>
<span id="cb8-27"><a href="var.html#cb8-27" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(pl_vert, pl_hor, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sim3b"></span>
<img src="HMsActivity_files/figure-html/sim3b-1.png" alt="Bimodal probability activity curves showing variability in frequency of site-use (A) and variability in timing of activity (B); displayed are activity curves across sites (dashed lines) along with the marginal mean curves (black lines) and conditional mean curves (red lines)." width="672" />
<p class="caption">
Figure 2.2: Bimodal probability activity curves showing variability in frequency of site-use (A) and variability in timing of activity (B); displayed are activity curves across sites (dashed lines) along with the marginal mean curves (black lines) and conditional mean curves (red lines).
</p>
</div>
<p>The dashed lines in Figure <a href="var.html#fig:sim3b">2.2</a> panel B represent curves simulated using different values of <span class="math inline">\(\gamma_i\)</span> (darker to lighter colors from lower to higher in absolute values). Varying the random phaseshift <span class="math inline">\(\gamma_i\)</span> results in activity curves that are shifted horizontally. Because we are simulating data using two cosine terms, the cumulative effects of the two random phaseshifts (one per cosine term) also affect the intensity of site-use.</p>
<p><strong>Site-to-site variability in a unimodal pattern.</strong> For completeness, we also present how variability affects a unimodal activity pattern. We can simulate this activity pattern by re-running the code above without the second cosine term, that is, by setting <span class="math inline">\(\beta_2 = 0\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="var.html#cb9-1" tabindex="-1"></a><span class="co">#Setup data</span></span>
<span id="cb9-2"><a href="var.html#cb9-2" tabindex="-1"></a>p_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb9-3"><a href="var.html#cb9-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb9-4"><a href="var.html#cb9-4" tabindex="-1"></a> p_df<span class="ot">&lt;-</span><span class="fu">rbind</span>(p_df, </span>
<span id="cb9-5"><a href="var.html#cb9-5" tabindex="-1"></a>             <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span>theta0 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span> tau_i[i]),</span>
<span id="cb9-6"><a href="var.html#cb9-6" tabindex="-1"></a>                        <span class="at">time =</span> time, </span>
<span id="cb9-7"><a href="var.html#cb9-7" tabindex="-1"></a>                        <span class="at">curvesID =</span> <span class="fu">rep</span>(<span class="fu">as.factor</span>(i), <span class="fu">length</span>(time))</span>
<span id="cb9-8"><a href="var.html#cb9-8" tabindex="-1"></a>                        )</span>
<span id="cb9-9"><a href="var.html#cb9-9" tabindex="-1"></a>            )</span>
<span id="cb9-10"><a href="var.html#cb9-10" tabindex="-1"></a>}</span>
<span id="cb9-11"><a href="var.html#cb9-11" tabindex="-1"></a>p_df<span class="sc">$</span>curvesLeg <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>, <span class="st">&quot;Conditional&quot;</span>, <span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>), </span>
<span id="cb9-12"><a href="var.html#cb9-12" tabindex="-1"></a>                               <span class="at">each =</span> <span class="fu">length</span>(time)</span>
<span id="cb9-13"><a href="var.html#cb9-13" tabindex="-1"></a>                               )</span>
<span id="cb9-14"><a href="var.html#cb9-14" tabindex="-1"></a>                           )</span>
<span id="cb9-15"><a href="var.html#cb9-15" tabindex="-1"></a><span class="co"># change in frequency of site-use</span></span>
<span id="cb9-16"><a href="var.html#cb9-16" tabindex="-1"></a>p_df<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>), </span>
<span id="cb9-17"><a href="var.html#cb9-17" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">&quot;on&quot;</span>, <span class="fu">length</span>(time)), </span>
<span id="cb9-18"><a href="var.html#cb9-18" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>)</span>
<span id="cb9-19"><a href="var.html#cb9-19" tabindex="-1"></a>               )</span>
<span id="cb9-20"><a href="var.html#cb9-20" tabindex="-1"></a> </span>
<span id="cb9-21"><a href="var.html#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="var.html#cb9-22" tabindex="-1"></a><span class="co"># calculate the marginal mean activity curve</span></span>
<span id="cb9-23"><a href="var.html#cb9-23" tabindex="-1"></a>p_marg <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(time), <span class="dv">1</span>)</span>
<span id="cb9-24"><a href="var.html#cb9-24" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(time)){</span>
<span id="cb9-25"><a href="var.html#cb9-25" tabindex="-1"></a>  intfun<span class="ot">&lt;-</span><span class="cf">function</span>(tau_x){</span>
<span id="cb9-26"><a href="var.html#cb9-26" tabindex="-1"></a>    <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span> theta0 <span class="sc">+</span> gamma_i[<span class="dv">4</span>]) <span class="sc">+</span> tau_x</span>
<span id="cb9-27"><a href="var.html#cb9-27" tabindex="-1"></a>           ) <span class="sc">*</span>  <span class="fu">dnorm</span>(tau_x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb9-28"><a href="var.html#cb9-28" tabindex="-1"></a>  }</span>
<span id="cb9-29"><a href="var.html#cb9-29" tabindex="-1"></a>    p_marg[i]<span class="ot">&lt;-</span><span class="fu">integrate</span>(intfun,<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)[<span class="dv">1</span>]</span>
<span id="cb9-30"><a href="var.html#cb9-30" tabindex="-1"></a>}</span>
<span id="cb9-31"><a href="var.html#cb9-31" tabindex="-1"></a>p_df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">unlist</span>(p_marg),</span>
<span id="cb9-32"><a href="var.html#cb9-32" tabindex="-1"></a>                    <span class="at">time =</span> time,</span>
<span id="cb9-33"><a href="var.html#cb9-33" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="st">&quot;on&quot;</span>, </span>
<span id="cb9-34"><a href="var.html#cb9-34" tabindex="-1"></a>                    <span class="at">curvesID =</span> <span class="fu">as.factor</span>(<span class="dv">8</span>),</span>
<span id="cb9-35"><a href="var.html#cb9-35" tabindex="-1"></a>                    <span class="at">curvesLeg =</span> <span class="fu">as.factor</span>(<span class="st">&quot;Marginal&quot;</span>)</span>
<span id="cb9-36"><a href="var.html#cb9-36" tabindex="-1"></a>                    )</span>
<span id="cb9-37"><a href="var.html#cb9-37" tabindex="-1"></a>p_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p_df, p_df2)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb10-1"><a href="var.html#cb10-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb10-2"><a href="var.html#cb10-2" tabindex="-1"></a>pl_vert_uni <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(p_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p, <span class="at">group =</span> curvesID)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="var.html#cb10-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> curvesLeg, <span class="at">linewidth =</span> mean, <span class="at">linetype =</span> mean)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="var.html#cb10-4" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey40&quot;</span>, <span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="var.html#cb10-5" tabindex="-1"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb10-6"><a href="var.html#cb10-6" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb10-7"><a href="var.html#cb10-7" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fu">max</span>(p_df<span class="sc">$</span>p)<span class="sc">+</span><span class="fl">0.053</span>)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="var.html#cb10-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Activity Patterns&quot;</span>, <span class="at">title =</span> <span class="st">&quot;A) Variability in frequency of site-use&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="var.html#cb10-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb10-10"><a href="var.html#cb10-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb10-11"><a href="var.html#cb10-11" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb10-12"><a href="var.html#cb10-12" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>), </span>
<span id="cb10-13"><a href="var.html#cb10-13" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="co">#element_text(size=8),</span></span>
<span id="cb10-14"><a href="var.html#cb10-14" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb10-15"><a href="var.html#cb10-15" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-16"><a href="var.html#cb10-16" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()</span>
<span id="cb10-17"><a href="var.html#cb10-17" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb10-18"><a href="var.html#cb10-18" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fu">min</span>(p), <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fu">min</span>(p)<span class="sc">-</span><span class="fl">0.05</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb10-19"><a href="var.html#cb10-19" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-20"><a href="var.html#cb10-20" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fu">max</span>(p)<span class="sc">+</span><span class="fl">0.003</span>, <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fu">max</span>(p)<span class="sc">+</span><span class="fl">0.053</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb10-21"><a href="var.html#cb10-21" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>)<span class="sc">+</span></span>
<span id="cb10-22"><a href="var.html#cb10-22" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)) </span>
<span id="cb10-23"><a href="var.html#cb10-23" tabindex="-1"></a></span>
<span id="cb10-24"><a href="var.html#cb10-24" tabindex="-1"></a><span class="co"># change in timing of activity</span></span>
<span id="cb10-25"><a href="var.html#cb10-25" tabindex="-1"></a><span class="co"># creating the curves</span></span>
<span id="cb10-26"><a href="var.html#cb10-26" tabindex="-1"></a>p_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb10-27"><a href="var.html#cb10-27" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb10-28"><a href="var.html#cb10-28" tabindex="-1"></a> p_df<span class="ot">&lt;-</span><span class="fu">rbind</span>(p_df, </span>
<span id="cb10-29"><a href="var.html#cb10-29" tabindex="-1"></a>             <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span>theta0 <span class="sc">+</span> gamma_i[i]) <span class="sc">+</span>  tau_i[<span class="dv">4</span>]),</span>
<span id="cb10-30"><a href="var.html#cb10-30" tabindex="-1"></a>                        <span class="at">time =</span> time, </span>
<span id="cb10-31"><a href="var.html#cb10-31" tabindex="-1"></a>                        <span class="at">curvesID =</span> <span class="fu">rep</span>(<span class="fu">as.factor</span>(i), <span class="fu">length</span>(time))</span>
<span id="cb10-32"><a href="var.html#cb10-32" tabindex="-1"></a>                        )</span>
<span id="cb10-33"><a href="var.html#cb10-33" tabindex="-1"></a>            )</span>
<span id="cb10-34"><a href="var.html#cb10-34" tabindex="-1"></a>}</span>
<span id="cb10-35"><a href="var.html#cb10-35" tabindex="-1"></a>p_df<span class="sc">$</span>curvesLeg <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>, <span class="st">&quot;Conditional&quot;</span>, <span class="st">&quot;+/- 0.5 SD&quot;</span>, <span class="st">&quot;+/- 1 SD&quot;</span>, <span class="st">&quot;+/- 1.5 SD&quot;</span>), </span>
<span id="cb10-36"><a href="var.html#cb10-36" tabindex="-1"></a>                               <span class="at">each =</span> <span class="fu">length</span>(time)</span>
<span id="cb10-37"><a href="var.html#cb10-37" tabindex="-1"></a>                               )</span>
<span id="cb10-38"><a href="var.html#cb10-38" tabindex="-1"></a>                           )</span>
<span id="cb10-39"><a href="var.html#cb10-39" tabindex="-1"></a>p_df<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;on&quot;</span>, <span class="fu">length</span>(time)), <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="st">&quot;off&quot;</span>, <span class="fu">length</span>(time)),<span class="dv">3</span>))</span>
<span id="cb10-40"><a href="var.html#cb10-40" tabindex="-1"></a></span>
<span id="cb10-41"><a href="var.html#cb10-41" tabindex="-1"></a><span class="co"># calculate the marginal mean activity curve by integrating over the distribution of the random effects</span></span>
<span id="cb10-42"><a href="var.html#cb10-42" tabindex="-1"></a>p_marg <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(time), <span class="dv">1</span>)</span>
<span id="cb10-43"><a href="var.html#cb10-43" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(time)){</span>
<span id="cb10-44"><a href="var.html#cb10-44" tabindex="-1"></a>  intfun<span class="ot">&lt;-</span><span class="cf">function</span>(gamma_x){</span>
<span id="cb10-45"><a href="var.html#cb10-45" tabindex="-1"></a>     <span class="fu">plogis</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time[i]<span class="sc">/</span>(<span class="dv">24</span>)<span class="sc">+</span> theta0 <span class="sc">+</span> gamma_x) <span class="sc">+</span>tau_i[<span class="dv">4</span>]</span>
<span id="cb10-46"><a href="var.html#cb10-46" tabindex="-1"></a>            ) <span class="sc">*</span> <span class="fu">dnorm</span>(gamma_x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb10-47"><a href="var.html#cb10-47" tabindex="-1"></a>       }</span>
<span id="cb10-48"><a href="var.html#cb10-48" tabindex="-1"></a>       p_marg[i]<span class="ot">&lt;-</span><span class="fu">integrate</span>(intfun,<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)[<span class="dv">1</span>]</span>
<span id="cb10-49"><a href="var.html#cb10-49" tabindex="-1"></a>}</span>
<span id="cb10-50"><a href="var.html#cb10-50" tabindex="-1"></a>p_df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p =</span> <span class="fu">unlist</span>(p_marg),</span>
<span id="cb10-51"><a href="var.html#cb10-51" tabindex="-1"></a>                    <span class="at">time =</span> time,</span>
<span id="cb10-52"><a href="var.html#cb10-52" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="st">&quot;on&quot;</span>, </span>
<span id="cb10-53"><a href="var.html#cb10-53" tabindex="-1"></a>                    <span class="at">curvesID =</span> <span class="fu">as.factor</span>(<span class="dv">8</span>),</span>
<span id="cb10-54"><a href="var.html#cb10-54" tabindex="-1"></a>                    <span class="at">curvesLeg =</span> <span class="fu">as.factor</span>(<span class="st">&quot;Marginal&quot;</span>)</span>
<span id="cb10-55"><a href="var.html#cb10-55" tabindex="-1"></a>                    )</span>
<span id="cb10-56"><a href="var.html#cb10-56" tabindex="-1"></a>p_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p_df, p_df2)</span>
<span id="cb10-57"><a href="var.html#cb10-57" tabindex="-1"></a></span>
<span id="cb10-58"><a href="var.html#cb10-58" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb10-59"><a href="var.html#cb10-59" tabindex="-1"></a>pl_hor_uni <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(p_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p, <span class="at">group =</span> curvesID)) <span class="sc">+</span></span>
<span id="cb10-60"><a href="var.html#cb10-60" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> curvesLeg, <span class="at">linewidth =</span> mean, <span class="at">linetype =</span> mean)) <span class="sc">+</span></span>
<span id="cb10-61"><a href="var.html#cb10-61" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey40&quot;</span>, <span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb10-62"><a href="var.html#cb10-62" tabindex="-1"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb10-63"><a href="var.html#cb10-63" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-64"><a href="var.html#cb10-64" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Activity Patterns&quot;</span>, <span class="at">title =</span> <span class="st">&quot;B) Variability in timing of activity&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-65"><a href="var.html#cb10-65" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb10-66"><a href="var.html#cb10-66" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb10-67"><a href="var.html#cb10-67" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb10-68"><a href="var.html#cb10-68" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb10-69"><a href="var.html#cb10-69" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="co">#element_text(size=8),</span></span>
<span id="cb10-70"><a href="var.html#cb10-70" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb10-71"><a href="var.html#cb10-71" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-72"><a href="var.html#cb10-72" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()</span>
<span id="cb10-73"><a href="var.html#cb10-73" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb10-74"><a href="var.html#cb10-74" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fl">13.5</span> <span class="sc">-</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="fl">13.5</span> <span class="sc">-</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb10-75"><a href="var.html#cb10-75" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-76"><a href="var.html#cb10-76" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fl">13.5</span> <span class="sc">+</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="fl">13.5</span> <span class="sc">+</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(p) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb10-77"><a href="var.html#cb10-77" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-78"><a href="var.html#cb10-78" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb10-79"><a href="var.html#cb10-79" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linetype=</span><span class="fu">element_blank</span>())</span>
<span id="cb10-80"><a href="var.html#cb10-80" tabindex="-1"></a></span>
<span id="cb10-81"><a href="var.html#cb10-81" tabindex="-1"></a></span>
<span id="cb10-82"><a href="var.html#cb10-82" tabindex="-1"></a><span class="co"># Join plots</span></span>
<span id="cb10-83"><a href="var.html#cb10-83" tabindex="-1"></a>pl_uni <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(pl_vert_uni, pl_hor_uni, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sim4b"></span>
<img src="HMsActivity_files/figure-html/sim4b-1.png" alt="Unimodal probability activity curves showing variability in frequency of site-use (A) and variability in timing of activity (B); displayed are activity curves across sites (dashed lines) along with the marginal mean curves (black lines) and conditional mean curves (red lines)." width="672" />
<p class="caption">
Figure 2.3: Unimodal probability activity curves showing variability in frequency of site-use (A) and variability in timing of activity (B); displayed are activity curves across sites (dashed lines) along with the marginal mean curves (black lines) and conditional mean curves (red lines).
</p>
</div>
<p>This second example (Figure <a href="var.html#fig:sim4b">2.3</a>) clearly illustrates how varying <span class="math inline">\(\gamma_i\)</span> (while keeping all the other parameters constant) leads to the horizontal shift of the curves, with peaks in activity equal across time but occurring at different times of the diel cycle.</p>
<p>In the next Tutorial, we simulate data drawing values of <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\gamma_i\)</span> from the normal distributions specified at the beginning of this Tutorial. We use these simulated data to illustrate how trigonometric and cyclic cubic regression spline hierarchical models can be used to estimate activity patterns. We will further elaborate on differences between conditional and marginal mean activity patterns in Tutorial <a href="condvsmarg.html#condvsmarg">8</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="est.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
