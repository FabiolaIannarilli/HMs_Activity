<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tutorial 3 Estimating activity patterns from time-stamped data | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</title>
  <meta name="description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Tutorial 3 Estimating activity patterns from time-stamped data | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tutorial 3 Estimating activity patterns from time-stamped data | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  
  <meta name="twitter:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="var.html"/>
<link rel="next" href="dataprep.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="var.html"><a href="var.html"><i class="fa fa-check"></i><b>2</b> Variability in activity patterns</a>
<ul>
<li class="chapter" data-level="2.1" data-path="var.html"><a href="var.html#variability-in-frequency-of-site-use"><i class="fa fa-check"></i><b>2.1</b> Variability in frequency of site-use</a></li>
<li class="chapter" data-level="2.2" data-path="var.html"><a href="var.html#variability-in-timing-of-activity"><i class="fa fa-check"></i><b>2.2</b> Variability in timing of activity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="est.html"><a href="est.html"><i class="fa fa-check"></i><b>3</b> Estimating activity patterns from time-stamped data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="est.html"><a href="est.html#simulating-activity-patterns"><i class="fa fa-check"></i><b>3.1</b> Simulating activity patterns</a></li>
<li class="chapter" data-level="3.2" data-path="est.html"><a href="est.html#data-preparation"><i class="fa fa-check"></i><b>3.2</b> Data preparation</a></li>
<li class="chapter" data-level="3.3" data-path="est.html"><a href="est.html#trigonometric-glmms"><i class="fa fa-check"></i><b>3.3</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="3.4" data-path="est.html"><a href="est.html#cyclic-cubic-spline-hgams"><i class="fa fa-check"></i><b>3.4</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataprep.html"><a href="dataprep.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a></li>
<li class="chapter" data-level="5" data-path="unibim.html"><a href="unibim.html"><i class="fa fa-check"></i><b>5</b> Evaluating hypotheses regarding the shape of activity curves</a></li>
<li class="chapter" data-level="6" data-path="cov.html"><a href="cov.html"><i class="fa fa-check"></i><b>6</b> Modeling activity patterns with covariates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cov.html"><a href="cov.html#cat"><i class="fa fa-check"></i><b>6.1</b> Categorical covariates</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cov.html"><a href="cov.html#trigonometric-glmms-1"><i class="fa fa-check"></i><b>6.1.1</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="6.1.2" data-path="cov.html"><a href="cov.html#cyclic-cubic-spline-hgams-1"><i class="fa fa-check"></i><b>6.1.2</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cov.html"><a href="cov.html#cont"><i class="fa fa-check"></i><b>6.2</b> Continuous covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="temppart.html"><a href="temppart.html"><i class="fa fa-check"></i><b>7</b> Temporal partitioning</a></li>
<li class="chapter" data-level="8" data-path="condvsmarg.html"><a href="condvsmarg.html"><i class="fa fa-check"></i><b>8</b> Conditional and marginal mean activity patterns</a>
<ul>
<li class="chapter" data-level="8.1" data-path="condvsmarg.html"><a href="condvsmarg.html#estimating-conditional-and-marginal-mean-activity-patterns"><i class="fa fa-check"></i><b>8.1</b> Estimating conditional and marginal mean activity patterns</a></li>
<li class="chapter" data-level="8.2" data-path="condvsmarg.html"><a href="condvsmarg.html#the-frequentist-framework"><i class="fa fa-check"></i><b>8.2</b> The frequentist framework</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="kdes.html"><a href="kdes.html"><i class="fa fa-check"></i><b>9</b> Kernel Density Estimators</a>
<ul>
<li class="chapter" data-level="9.1" data-path="kdes.html"><a href="kdes.html#dataprepkdes"><i class="fa fa-check"></i><b>9.1</b> Data preparation for KDEs</a></li>
<li class="chapter" data-level="9.2" data-path="kdes.html"><a href="kdes.html#kdespkg"><i class="fa fa-check"></i><b>9.2</b> Comparison of KDE estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="kdes.html"><a href="kdes.html#using-the-overlap-package"><i class="fa fa-check"></i><b>9.2.1</b> Using the overlap package</a></li>
<li class="chapter" data-level="9.2.2" data-path="kdes.html"><a href="kdes.html#using-the-activity-package"><i class="fa fa-check"></i><b>9.2.2</b> Using the activity package</a></li>
<li class="chapter" data-level="9.2.3" data-path="kdes.html"><a href="kdes.html#using-the-circular-package"><i class="fa fa-check"></i><b>9.2.3</b> Using the circular package</a></li>
<li class="chapter" data-level="9.2.4" data-path="kdes.html"><a href="kdes.html#comparing-the-results-and-plotting"><i class="fa fa-check"></i><b>9.2.4</b> Comparing the results and plotting</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="kdes.html"><a href="kdes.html#kdedataaggr"><i class="fa fa-check"></i><b>9.3</b> Aggregating <em>versus</em> non-aggregating data in KDEs</a></li>
<li class="chapter" data-level="9.4" data-path="kdes.html"><a href="kdes.html#compkde"><i class="fa fa-check"></i><b>9.4</b> KDEs <em>versus</em> hierarchical models approaches</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="app.html"><a href="app.html"><i class="fa fa-check"></i><b>10</b> Appendix</a>
<ul>
<li class="chapter" data-level="10.1" data-path="app.html"><a href="app.html#simfunction"><i class="fa fa-check"></i><b>10.1</b> The <em>sim_activity</em> function</a></li>
<li class="chapter" data-level="10.2" data-path="app.html"><a href="app.html#poisson"><i class="fa fa-check"></i><b>10.2</b> Binomial versus other distributions</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="app.html"><a href="app.html#data-preparation-1"><i class="fa fa-check"></i><b>10.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.2.2" data-path="app.html"><a href="app.html#trigonometric-pdf-comparison"><i class="fa fa-check"></i><b>10.2.2</b> Trigonometric PDF comparison</a></li>
<li class="chapter" data-level="10.2.3" data-path="app.html"><a href="app.html#cyclic-cubic-pdf-comparison"><i class="fa fa-check"></i><b>10.2.3</b> Cyclic cubic PDF comparison</a></li>
<li class="chapter" data-level="10.2.4" data-path="app.html"><a href="app.html#not-controlling-for-sampling-effort"><i class="fa fa-check"></i><b>10.2.4</b> Not controlling for sampling effort</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="app.html"><a href="app.html#bay"><i class="fa fa-check"></i><b>10.3</b> Activity patterns in the Bayesian framework</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="app.html"><a href="app.html#data-preparation-2"><i class="fa fa-check"></i><b>10.3.1</b> Data Preparation</a></li>
<li class="chapter" data-level="10.3.2" data-path="app.html"><a href="app.html#model-setup-and-fitting"><i class="fa fa-check"></i><b>10.3.2</b> Model Setup and Fitting</a></li>
<li class="chapter" data-level="10.3.3" data-path="app.html"><a href="app.html#model-assessment"><i class="fa fa-check"></i><b>10.3.3</b> Model Assessment</a></li>
<li class="chapter" data-level="10.3.4" data-path="app.html"><a href="app.html#model-predictions"><i class="fa fa-check"></i><b>10.3.4</b> Model Predictions</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="app.html"><a href="app.html#DielNiche"><i class="fa fa-check"></i><b>10.4</b> Link to the Diel.Niche package</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="app.html"><a href="app.html#data"><i class="fa fa-check"></i><b>10.4.1</b> Data</a></li>
<li class="chapter" data-level="10.4.2" data-path="app.html"><a href="app.html#model-fitting"><i class="fa fa-check"></i><b>10.4.2</b> Model Fitting</a></li>
<li class="chapter" data-level="10.4.3" data-path="app.html"><a href="app.html#model-predictions-1"><i class="fa fa-check"></i><b>10.4.3</b> Model Predictions</a></li>
<li class="chapter" data-level="10.4.4" data-path="app.html"><a href="app.html#twilight-daytime-and-nighttime"><i class="fa fa-check"></i><b>10.4.4</b> Twilight, daytime, and nighttime</a></li>
<li class="chapter" data-level="10.4.5" data-path="app.html"><a href="app.html#diel.niche"><i class="fa fa-check"></i><b>10.4.5</b> Diel.Niche</a></li>
<li class="chapter" data-level="10.4.6" data-path="app.html"><a href="app.html#conclusion"><i class="fa fa-check"></i><b>10.4.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="app.html"><a href="app.html#info-session"><i class="fa fa-check"></i><b>10.5</b> Info session</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="est" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Tutorial 3</span> Estimating activity patterns from time-stamped data<a href="est.html#est" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Activity patterns are currently estimated primarily using Kernel Density Estimators (KDEs). However, this approach presents several limitations that we highlight in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>. In this Tutorial, we introduce two alternative, model-based approaches to estimate activity patterns from time-stamped data:</p>
<ul>
<li><p><em>trigonometric generalized linear mixed models</em> (trigonometric GLMMs) and</p></li>
<li><p><em>cyclic cubic spline generalized linear mixed models</em> (cyclic cubic spline HGAMs).</p></li>
</ul>
<p>Both types of hierarchical models can accommodate the periodic nature of activity data and also address site-to-site and other forms of variability. Although our examples are all focused on the analysis of camera-trap data, the same framework can be applied to data collected using other static devices (e.g., acoustic recorders) or site-based sampling strategies.</p>
<div id="simulating-activity-patterns" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Simulating activity patterns<a href="est.html#simulating-activity-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To show how trigonometric and cyclic cubic spline hierarchical models can successfully recover the true pattern of activity, we apply these approaches to simulated data. As such, we can compare the estimated patterns to the known, ‘true’, simulated patterns.</p>
<p>To keep the focus on estimating activity patterns, we encapsulate the code to simulate the data in the function <code>sim_activity</code>, that we source after loading the necessary libraries. This function simulates data based on equation 1 (Tutorial <a href="var.html#var">2</a> and Materials and Results in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>). The function is available in the <code>source_functions</code> folder available at <a href="https://github.com/FabiolaIannarilli/HMs_Activity" class="uri">https://github.com/FabiolaIannarilli/HMs_Activity</a>; a description of its arguments and outputs is provided in section <a href="app.html#simfunction">10.1</a>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="est.html#cb15-1" tabindex="-1"></a><span class="co"># Load libraries and function to simulate activity patterns</span></span>
<span id="cb15-2"><a href="est.html#cb15-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">129</span>)</span>
<span id="cb15-3"><a href="est.html#cb15-3" tabindex="-1"></a><span class="fu">suppressWarnings</span>({ </span>
<span id="cb15-4"><a href="est.html#cb15-4" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb15-5"><a href="est.html#cb15-5" tabindex="-1"></a>  <span class="fu">library</span>(GLMMadaptive)</span>
<span id="cb15-6"><a href="est.html#cb15-6" tabindex="-1"></a>  <span class="fu">library</span>(ggpubr)</span>
<span id="cb15-7"><a href="est.html#cb15-7" tabindex="-1"></a>  <span class="fu">library</span>(mgcv)</span>
<span id="cb15-8"><a href="est.html#cb15-8" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb15-9"><a href="est.html#cb15-9" tabindex="-1"></a>})</span>
<span id="cb15-10"><a href="est.html#cb15-10" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;source_functions/sim_activity.R&quot;</span>)</span>
<span id="cb15-11"><a href="est.html#cb15-11" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;source_functions/sim_to_minute.R&quot;</span>)</span></code></pre></div>
<p>We simulate site-specific bimodal activity patterns for 100 sites (M) and 30 days (J) using the parameters defined in the code below. We include both variability in frequency of site-use and variability in timing of activity by drawing values of <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\gamma_i\)</span> from the distributions <span class="math inline">\(\tau_i \sim N(0,\sigma_\tau)\)</span> and <span class="math inline">\(\gamma_i \sim N(0,\sigma_\gamma)\)</span>, respectively, with <span class="math inline">\(\sigma_\tau = 1\)</span> and <span class="math inline">\(\sigma_\gamma = 0.3\)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="est.html#cb16-1" tabindex="-1"></a><span class="co"># Set equations&#39; parameters</span></span>
<span id="cb16-2"><a href="est.html#cb16-2" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb16-3"><a href="est.html#cb16-3" tabindex="-1"></a>J <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb16-4"><a href="est.html#cb16-4" tabindex="-1"></a>wavelength <span class="ot">=</span> <span class="dv">24</span></span>
<span id="cb16-5"><a href="est.html#cb16-5" tabindex="-1"></a>n_peak <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb16-6"><a href="est.html#cb16-6" tabindex="-1"></a>b0 <span class="ot">=</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb16-7"><a href="est.html#cb16-7" tabindex="-1"></a>b1 <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb16-8"><a href="est.html#cb16-8" tabindex="-1"></a>b2 <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb16-9"><a href="est.html#cb16-9" tabindex="-1"></a>theta0 <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb16-10"><a href="est.html#cb16-10" tabindex="-1"></a>theta1 <span class="ot">=</span> <span class="dv">2</span> </span>
<span id="cb16-11"><a href="est.html#cb16-11" tabindex="-1"></a>sd_tau <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb16-12"><a href="est.html#cb16-12" tabindex="-1"></a>sd_gamma <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb16-13"><a href="est.html#cb16-13" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb16-14"><a href="est.html#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="est.html#cb16-15" tabindex="-1"></a><span class="co"># simulate data</span></span>
<span id="cb16-16"><a href="est.html#cb16-16" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">sim_activity</span>(<span class="at">M =</span> M, </span>
<span id="cb16-17"><a href="est.html#cb16-17" tabindex="-1"></a>                    <span class="at">J =</span> J, </span>
<span id="cb16-18"><a href="est.html#cb16-18" tabindex="-1"></a>                    <span class="at">wavelength =</span> wavelength, </span>
<span id="cb16-19"><a href="est.html#cb16-19" tabindex="-1"></a>                    <span class="at">n_peak =</span> n_peak, </span>
<span id="cb16-20"><a href="est.html#cb16-20" tabindex="-1"></a>                    <span class="at">n_sim =</span> <span class="dv">1</span>, </span>
<span id="cb16-21"><a href="est.html#cb16-21" tabindex="-1"></a>                    <span class="at">b0 =</span> b0, </span>
<span id="cb16-22"><a href="est.html#cb16-22" tabindex="-1"></a>                    <span class="at">b0_constant =</span> <span class="cn">TRUE</span>, <span class="co"># common intercept</span></span>
<span id="cb16-23"><a href="est.html#cb16-23" tabindex="-1"></a>                    <span class="at">tau_constant =</span> <span class="cn">FALSE</span>, </span>
<span id="cb16-24"><a href="est.html#cb16-24" tabindex="-1"></a>                    <span class="at">sdtau =</span> sd_tau, <span class="co"># ~site-specific intercept</span></span>
<span id="cb16-25"><a href="est.html#cb16-25" tabindex="-1"></a>                    <span class="at">b1 =</span> b1, </span>
<span id="cb16-26"><a href="est.html#cb16-26" tabindex="-1"></a>                    <span class="at">b2 =</span> b2, <span class="co"># amplitude of the cosine terms </span></span>
<span id="cb16-27"><a href="est.html#cb16-27" tabindex="-1"></a>                    <span class="at">theta0 =</span> theta0, </span>
<span id="cb16-28"><a href="est.html#cb16-28" tabindex="-1"></a>                    <span class="at">theta1 =</span> theta1, <span class="co"># common phaseshifts for the cosine terms</span></span>
<span id="cb16-29"><a href="est.html#cb16-29" tabindex="-1"></a>                    <span class="at">phaseshift_constant =</span> <span class="cn">FALSE</span>, </span>
<span id="cb16-30"><a href="est.html#cb16-30" tabindex="-1"></a>                    <span class="at">sd_phaseshift =</span> sd_gamma, <span class="co"># site-specific phaseshift (equal for both cosine terms)</span></span>
<span id="cb16-31"><a href="est.html#cb16-31" tabindex="-1"></a>                    <span class="at">plot_true_act =</span> <span class="cn">FALSE</span></span>
<span id="cb16-32"><a href="est.html#cb16-32" tabindex="-1"></a>                    )</span>
<span id="cb16-33"><a href="est.html#cb16-33" tabindex="-1"></a><span class="co">#Observe the structure of the new object</span></span>
<span id="cb16-34"><a href="est.html#cb16-34" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code></pre></div>
<pre><code>## List of 5
##  $ true_activity_prob: num [1:100, 1:720] 0.00354 0.00474 0.00263 0.00297 0.07437 ...
##  $ Conditional       :&#39;data.frame&#39;:  513 obs. of  3 variables:
##   ..$ p     : num [1:513] 0.0138 0.0135 0.0133 0.0131 0.0129 ...
##   ..$ time  : num [1:513] 0 0.0469 0.0938 0.1406 0.1875 ...
##   ..$ y_dens: num [1:513] 0.00931 0.00915 0.009 0.00885 0.00871 ...
##  $ Marginal          :&#39;data.frame&#39;:  513 obs. of  3 variables:
##   ..$ p     : num [1:513] 0.0233 0.0229 0.0226 0.0222 0.0219 ...
##   ..$ time  : num [1:513] 0 0.0469 0.0938 0.1406 0.1875 ...
##   ..$ y_dens: num [1:513] 0.0115 0.0113 0.0111 0.0109 0.0107 ...
##  $ sim_data          :List of 1
##   ..$ : int [1:100, 1:720] 0 0 0 0 0 1 0 0 0 0 ...
##  $ phaseshift        : num [1:100] 0.4761 -0.3666 -0.0015 -0.2245 -0.1194 ...</code></pre>
<p>The <code>sim_activity</code> function returns a list containing several objects, including the true activity patterns simulated for each of the 100 sites (object: <code>dat$true_activity_prob</code>) and the associated realized patterns (i.e. the encounter data; object: <code>dat$sim_data</code>). The list also contains the values of the conditional and marginal mean probability of activity (objects: <code>dat$Conditional</code> and <code>dat$Marginal</code>, respectively) and site-specific phaseshift values (object: <code>dat$phaseshift</code>).</p>
<p>We access the information for a randomly selected set of these sites and plot their true activity patterns, along with the conditional and marginal mean activity patterns (the red and black curves, respectively, in the following plot).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="est.html#cb18-1" tabindex="-1"></a><span class="co"># Organize data for plotting</span></span>
<span id="cb18-2"><a href="est.html#cb18-2" tabindex="-1"></a>sites_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>M, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-3"><a href="est.html#cb18-3" tabindex="-1"></a>sample_sites <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sites_i, dat<span class="sc">$</span>true_activity_prob[sites_i, <span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>]) </span>
<span id="cb18-4"><a href="est.html#cb18-4" tabindex="-1"></a><span class="fu">colnames</span>(sample_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sites&quot;</span>, <span class="dv">00</span><span class="sc">:</span><span class="dv">24</span>)</span>
<span id="cb18-5"><a href="est.html#cb18-5" tabindex="-1"></a>sample_sites <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sample_sites) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="est.html#cb18-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>sites, <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;prob&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb19-1"><a href="est.html#cb19-1" tabindex="-1"></a><span class="co">#plot true conditional and marginal with 10 simulated sites</span></span>
<span id="cb19-2"><a href="est.html#cb19-2" tabindex="-1"></a>(pl_sites <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="est.html#cb19-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sample_sites, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(time), <span class="at">y =</span> prob, <span class="at">group =</span> sites, <span class="at">color =</span> <span class="fu">as.factor</span>(sites)), </span>
<span id="cb19-4"><a href="est.html#cb19-4" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="est.html#cb19-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat<span class="sc">$</span>Conditional, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb19-6"><a href="est.html#cb19-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat<span class="sc">$</span>Marginal, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> p), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb19-7"><a href="est.html#cb19-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability of Activity&quot;</span>, <span class="at">title =</span> <span class="st">&quot;C) Variability in frequency of site-use and </span><span class="sc">\n</span><span class="st"> timing of activity&quot;</span>, </span>
<span id="cb19-8"><a href="est.html#cb19-8" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Site_ID&quot;</span>)<span class="sc">+</span></span>
<span id="cb19-9"><a href="est.html#cb19-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb19-10"><a href="est.html#cb19-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb19-11"><a href="est.html#cb19-11" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-12"><a href="est.html#cb19-12" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-13"><a href="est.html#cb19-13" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb19-14"><a href="est.html#cb19-14" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb19-15"><a href="est.html#cb19-15" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-16"><a href="est.html#cb19-16" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-17"><a href="est.html#cb19-17" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-18"><a href="est.html#cb19-18" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-19"><a href="est.html#cb19-19" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-20"><a href="est.html#cb19-20" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-21"><a href="est.html#cb19-21" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-22"><a href="est.html#cb19-22" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb19-23"><a href="est.html#cb19-23" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fu">min</span>(sample_sites<span class="sc">$</span>prob), <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fu">min</span>(sample_sites<span class="sc">$</span>prob)<span class="sc">-</span><span class="fl">0.05</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb19-24"><a href="est.html#cb19-24" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="est.html#cb19-25" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span>, <span class="at">y=</span><span class="fl">0.45+0.003</span>, <span class="at">xend=</span><span class="dv">12</span>, <span class="at">yend=</span><span class="fl">0.45+0.053</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb19-26"><a href="est.html#cb19-26" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-27"><a href="est.html#cb19-27" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span> <span class="sc">-</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(sample_sites<span class="sc">$</span>prob) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="dv">12</span> <span class="sc">-</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(sample_sites<span class="sc">$</span>prob) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb19-28"><a href="est.html#cb19-28" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-29"><a href="est.html#cb19-29" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">12</span> <span class="sc">+</span> <span class="fl">0.75</span>, <span class="at">y=</span><span class="fu">max</span>(sample_sites<span class="sc">$</span>prob) <span class="sc">+</span> <span class="fl">0.02</span>, <span class="at">xend=</span><span class="dv">12</span> <span class="sc">+</span> <span class="dv">7</span>, <span class="at">yend=</span><span class="fu">max</span>(sample_sites<span class="sc">$</span>prob) <span class="sc">+</span> <span class="fl">0.02</span>), <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length=</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb19-30"><a href="est.html#cb19-30" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linejoin =</span> <span class="st">&quot;mitre&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-31"><a href="est.html#cb19-31" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:est3b"></span>
<img src="HMsActivity_files/figure-html/est3b-1.png" alt="Bimodal probability activity curves showing variability in both the frequency of site-use and variability in timing of activity; displayed are activity curves across sites (dashed lines) along with the marginal mean curve (black line) and conditional mean curve (red line)." width="672" />
<p class="caption">
Figure 3.1: Bimodal probability activity curves showing variability in both the frequency of site-use and variability in timing of activity; displayed are activity curves across sites (dashed lines) along with the marginal mean curve (black line) and conditional mean curve (red line).
</p>
</div>
<p>We see there is considerable variability in the frequency of use among the different sites and relatively smaller variation in timing of activity within the 24-hour cycle.</p>
<p>To create Figure 1 in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>, we bring together this plot and the two produced in the previous Tutorial.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="est.html#cb20-1" tabindex="-1"></a><span class="fu">ggarrange</span>(pl, pl_sites, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">66</span>, <span class="dv">34</span>)) <span class="sc">%&gt;%</span>   </span>
<span id="cb20-2"><a href="est.html#cb20-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;ms_figures/Fig1_Site_Variability_in_Activity_bimodal.jpg&quot;</span>, </span>
<span id="cb20-3"><a href="est.html#cb20-3" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;jpeg&quot;</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">width =</span> <span class="dv">24</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb20-4"><a href="est.html#cb20-4" tabindex="-1"></a>       )</span></code></pre></div>
</div>
<div id="data-preparation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Data preparation<a href="est.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first step to analyze the simulated activity patterns is to arrange the simulated encounter data in a specific format. These data are stored in the object <code>sim_data</code> in the list created by the <code>sim_activity</code> function. This object has a number of rows equal to the number of simulated sites (100) and a number of columns equal to 24 (hours) times the length (in days) of the simulated sampling period, which we set to 30 days. This corresponds to 720 columns (<span class="math inline">\(24 \text{hours} \times 30 \text{days}\)</span>), that is, 720 hourly encounter occasions.</p>
<p>We access the encounter data and store them in an object called <code>y</code>. We add a column that specifies a unique identifier for each site (e.g., <code>id = A1</code>) and assign a name to each of the columns to represent the consecutive time occasions (e.g., from 1 to 720). Then, we reorganize the data from the wide to the long format using the <code>id</code> column as the reference and convert the consecutive time occasions in the relative time of day (e.g., <code>time = 35</code> is converted to <code>Hour = 11</code> of the second day of sampling).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="est.html#cb21-1" tabindex="-1"></a><span class="co"># The data</span></span>
<span id="cb21-2"><a href="est.html#cb21-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dat<span class="sc">$</span>sim_data)</span>
<span id="cb21-3"><a href="est.html#cb21-3" tabindex="-1"></a><span class="fu">dim</span>(y)</span></code></pre></div>
<pre><code>## [1] 100 720</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="est.html#cb23-1" tabindex="-1"></a><span class="co"># summarize aggregated data</span></span>
<span id="cb23-2"><a href="est.html#cb23-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="fu">paste</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,M,<span class="dv">1</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>), </span>
<span id="cb23-3"><a href="est.html#cb23-3" tabindex="-1"></a>                <span class="at">y=</span><span class="fu">as.data.frame</span>(y)</span>
<span id="cb23-4"><a href="est.html#cb23-4" tabindex="-1"></a>                )</span>
<span id="cb23-5"><a href="est.html#cb23-5" tabindex="-1"></a><span class="fu">colnames</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, </span>
<span id="cb23-6"><a href="est.html#cb23-6" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">&quot;S&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(y)<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb23-7"><a href="est.html#cb23-7" tabindex="-1"></a>                 )</span>
<span id="cb23-8"><a href="est.html#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="est.html#cb23-9" tabindex="-1"></a><span class="co"># Format data in long format</span></span>
<span id="cb23-10"><a href="est.html#cb23-10" tabindex="-1"></a>y_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> y, <span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="est.html#cb23-11" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">time=</span><span class="fu">as.numeric</span>(<span class="fu">substr</span>(time,<span class="dv">2</span>,<span class="dv">10</span>)),</span>
<span id="cb23-12"><a href="est.html#cb23-12" tabindex="-1"></a>                       <span class="at">id =</span> <span class="fu">factor</span>(id)</span>
<span id="cb23-13"><a href="est.html#cb23-13" tabindex="-1"></a>                       )</span>
<span id="cb23-14"><a href="est.html#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="est.html#cb23-15" tabindex="-1"></a><span class="co"># create variable to describe time as hour (between 0 and 23)</span></span>
<span id="cb23-16"><a href="est.html#cb23-16" tabindex="-1"></a>y_long<span class="sc">$</span>hour <span class="ot">&lt;-</span> <span class="fu">sim_to_minute</span>(y_long<span class="sc">$</span>time, <span class="at">group =</span> wavelength)</span>
<span id="cb23-17"><a href="est.html#cb23-17" tabindex="-1"></a></span>
<span id="cb23-18"><a href="est.html#cb23-18" tabindex="-1"></a><span class="co"># show first few rows of the dataset created</span></span>
<span id="cb23-19"><a href="est.html#cb23-19" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(y_long))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="right">time</th>
<th align="right">y</th>
<th align="right">hour</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">A1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">A1</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>We obtain a dataset in which each row specifies the outcome (i.e. encounter or non-encounter of the target species) at a certain site during a specific hour of a certain day of sampling.</p>
<p>for our analysis, we can use this dataset as it is, considering <code>y</code> as our response variable. Alternatively, we can reduce model fitting computational time by counting the number of hourly-long occasions in which the species was observed (i.e. successes) and the number of occasions in which the species was not observed (i.e. failures) for each combination of hourly time interval (e.g., <code>time = 1</code>) and camera site (e.g. <code>id = A1</code>).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="est.html#cb24-1" tabindex="-1"></a><span class="co"># count successes and failures at each site-occasion</span></span>
<span id="cb24-2"><a href="est.html#cb24-2" tabindex="-1"></a>occasions_cbind <span class="ot">&lt;-</span> y_long <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="est.html#cb24-3" tabindex="-1"></a>  <span class="fu">group_by</span>(id, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="est.html#cb24-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">success =</span> <span class="fu">sum</span>(y),</span>
<span id="cb24-5"><a href="est.html#cb24-5" tabindex="-1"></a>            <span class="at">n_events =</span> <span class="fu">n</span>(),</span>
<span id="cb24-6"><a href="est.html#cb24-6" tabindex="-1"></a>            <span class="at">failure =</span> n_events <span class="sc">-</span> success) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="est.html#cb24-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Site =</span> id,</span>
<span id="cb24-8"><a href="est.html#cb24-8" tabindex="-1"></a>               <span class="at">Time =</span> hour)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;id&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="est.html#cb26-1" tabindex="-1"></a><span class="co"># show first few rows of the dataset created</span></span>
<span id="cb26-2"><a href="est.html#cb26-2" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(occasions_cbind))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Site</th>
<th align="right">Time</th>
<th align="right">success</th>
<th align="right">n_events</th>
<th align="right">failure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">30</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="right">29</td>
</tr>
<tr class="odd">
<td align="left">A1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">30</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="right">29</td>
</tr>
<tr class="odd">
<td align="left">A1</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">A1</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">30</td>
<td align="right">30</td>
</tr>
</tbody>
</table>
<p>In this new version of the dataset, each row specifies how many times a species was (i.e. <code>success</code>: 0 days) and was not (i.e. <code>failure</code>: 30 days) detected at a certain site (<code>Site = A1</code>) during a certain time interval (<code>Time = 0</code>, that is from 00:00 to 00:59). We can now use this dataframe to estimate the diel activity patterns using hierarchical models.</p>
</div>
<div id="trigonometric-glmms" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Trigonometric GLMMs<a href="est.html#trigonometric-glmms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Equation 1 in Tutorial <a href="var.html#var">2</a> is non-linear due the presence of the phaseshift parameters. Currently, we are unaware of any out-of-the-box options in the R programming language for fitting trigonometric non-linear mixed models using a frequentist approach. To overcome this challenge, we rewrite equation 1 using compound angle formulas (see also main text <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>):</p>
<p><span class="math display">\[
\text{logit}(p_t) = \beta_0 + \alpha_1 \times \text{cos}(\frac{2\pi t}{\omega_1}) + \alpha_2 \times \text{sin}(\frac{2\pi t}{\omega_1}) + \alpha_3 \times \text{cos}(\frac{2\pi t}{\omega_2}) + \alpha_4 \times \text{sin}(\frac{2\pi t}{\omega_2}) + \tau_i
\]</span>
where</p>
<p><span class="math inline">\(\alpha_1 = \beta_1 \times \text{cos}(\theta_0 + \gamma_i)\)</span>, <span class="math inline">\(\alpha_2= -\beta_1 \times \text{sin}(\theta_0 + \gamma_i)\)</span>, <span class="math inline">\(\alpha_3= \beta_2 \times \text{cos}(\theta_1 + \gamma_i)\)</span>, and <span class="math inline">\(\alpha_4= -\beta_2 \times \text{sin}(\theta_1 + \gamma_i)\)</span>.</p>
<p>In this version (labeled as equation 2 in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>), we can model activity patterns using any R package available for fitting GLMMs; we list some of these options in Tables 1 and 2 in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>. Here, we choose the <code>GLMMadaptive</code> library <span class="citation">(<a href="references.html#ref-Rizopoulos2022">Rizopoulos 2022</a>)</span> because it facilitates estimation of both conditional and marginal mean activity patterns (see Tutorial <a href="condvsmarg.html#condvsmarg">8</a>).</p>
<p>The simplest trigonometric GLMM we can run is one that includes only a random intercept. In the context of estimating activity patterns, a random intercept-only model accounts for variability in the frequency of site-use (i.e. vertical shifts among the curves), but not variability in the timing of activity (i.e. horizontal shift).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="est.html#cb27-1" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb27-2"><a href="est.html#cb27-2" tabindex="-1"></a>trig_rand_int <span class="ot">&lt;-</span> <span class="fu">mixed_model</span>(<span class="at">fixed =</span> <span class="fu">cbind</span>(success, failure) <span class="sc">~</span> </span>
<span id="cb27-3"><a href="est.html#cb27-3" tabindex="-1"></a>                              <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="est.html#cb27-4" tabindex="-1"></a>                              <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>),</span>
<span id="cb27-5"><a href="est.html#cb27-5" tabindex="-1"></a>                             <span class="at">random =</span> <span class="sc">~</span>  <span class="dv">1</span>  <span class="sc">|</span>   Site, </span>
<span id="cb27-6"><a href="est.html#cb27-6" tabindex="-1"></a>                             <span class="at">data =</span> occasions_cbind, </span>
<span id="cb27-7"><a href="est.html#cb27-7" tabindex="-1"></a>                             <span class="at">family =</span> <span class="fu">binomial</span>(), </span>
<span id="cb27-8"><a href="est.html#cb27-8" tabindex="-1"></a>                             <span class="at">iter_EM =</span> <span class="dv">0</span></span>
<span id="cb27-9"><a href="est.html#cb27-9" tabindex="-1"></a>                             )</span>
<span id="cb27-10"><a href="est.html#cb27-10" tabindex="-1"></a><span class="fu">summary</span>(trig_rand_int)</span></code></pre></div>
<pre><code>## 
## Call:
## mixed_model(fixed = cbind(success, failure) ~ cos(2 * pi * Time/24) + 
##     sin(2 * pi * Time/24) + cos(2 * pi * Time/12) + sin(2 * pi * 
##     Time/12), random = ~1 | Site, data = occasions_cbind, family = binomial(), 
##     iter_EM = 0)
## 
## Data Descriptives:
## Number of Observations: 2400
## Number of Groups: 100 
## 
## Model:
##  family: binomial
##  link: logit 
## 
## Fit statistics:
##    log.Lik      AIC      BIC
##  -3742.866 7497.732 7513.363
## 
## Random effects covariance matrix:
##                StdDev
## (Intercept) 0.9725664
## 
## Fixed effects:
##                       Estimate Std.Err  z-value p-value
## (Intercept)            -3.0670  0.0998 -30.7257 &lt; 1e-04
## cos(2 * pi * Time/24)  -0.9339  0.0263 -35.5111 &lt; 1e-04
## sin(2 * pi * Time/24)  -0.1321  0.0220  -6.0164 &lt; 1e-04
## cos(2 * pi * Time/12)  -0.2802  0.0225 -12.4511 &lt; 1e-04
## sin(2 * pi * Time/12)  -0.5891  0.0229 -25.7027 &lt; 1e-04
## 
## Integration:
## method: adaptive Gauss-Hermite quadrature rule
## quadrature points: 11
## 
## Optimization:
## method: quasi-Newton
## converged: TRUE</code></pre>
<p>For trigonometric models, it is difficult to interpret the coefficients. An easier and effective way to explore these results is to visually check the activity patterns predicted based on the model itself. Thus, we predict the estimated (conditional) activity pattern, backtrasform the results from logit to the probability scale, and plot the estimated activity pattern along with the true simulated (conditional mean) activity pattern.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="est.html#cb29-1" tabindex="-1"></a><span class="co"># estimated activity pattern</span></span>
<span id="cb29-2"><a href="est.html#cb29-2" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">with</span>(occasions_cbind, <span class="fu">expand.grid</span>(<span class="at">Time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(Time), <span class="dv">24</span>, <span class="at">length.out =</span> <span class="dv">48</span>)))</span>
<span id="cb29-3"><a href="est.html#cb29-3" tabindex="-1"></a>cond_eff0 <span class="ot">&lt;-</span> <span class="fu">effectPlotData</span>(trig_rand_int, newdat, <span class="at">marginal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="est.html#cb29-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">plogis</span>(pred),</span>
<span id="cb29-5"><a href="est.html#cb29-5" tabindex="-1"></a>         <span class="at">low =</span> <span class="fu">plogis</span>(low),</span>
<span id="cb29-6"><a href="est.html#cb29-6" tabindex="-1"></a>         <span class="at">upp =</span> <span class="fu">plogis</span>(upp),</span>
<span id="cb29-7"><a href="est.html#cb29-7" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Estimated: Random Intercept-only&quot;</span>)</span>
<span id="cb29-8"><a href="est.html#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="est.html#cb29-9" tabindex="-1"></a><span class="co"># simulated conditional activity pattern</span></span>
<span id="cb29-10"><a href="est.html#cb29-10" tabindex="-1"></a>cond_true <span class="ot">&lt;-</span> dat<span class="sc">$</span>Conditional <span class="sc">%&gt;%</span> </span>
<span id="cb29-11"><a href="est.html#cb29-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb29-12"><a href="est.html#cb29-12" tabindex="-1"></a>         <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb29-13"><a href="est.html#cb29-13" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Simulated Conditional&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-14"><a href="est.html#cb29-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Time =</span> time, <span class="at">pred =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb29-15"><a href="est.html#cb29-15" tabindex="-1"></a>  <span class="fu">select</span>(Time, pred, low, upp, Mod)</span>
<span id="cb29-16"><a href="est.html#cb29-16" tabindex="-1"></a></span>
<span id="cb29-17"><a href="est.html#cb29-17" tabindex="-1"></a><span class="co"># combine the two for visualization  purposes</span></span>
<span id="cb29-18"><a href="est.html#cb29-18" tabindex="-1"></a>cond_eff <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cond_true, cond_eff0)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb30-1"><a href="est.html#cb30-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb30-2"><a href="est.html#cb30-2" tabindex="-1"></a>(pl_trig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cond_eff, <span class="fu">aes</span>(Time, pred)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="est.html#cb30-3" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, <span class="at">color =</span> Mod, <span class="at">fill =</span> Mod), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb30-4"><a href="est.html#cb30-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Mod), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#</span></span>
<span id="cb30-5"><a href="est.html#cb30-5" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="est.html#cb30-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="est.html#cb30-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day (Hour)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Predicted Activity Pattern </span><span class="sc">\n</span><span class="st"> (probability)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Estimated vs Simulated Activity Patterns&quot;</span>)<span class="sc">+</span></span>
<span id="cb30-8"><a href="est.html#cb30-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb30-9"><a href="est.html#cb30-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb30-10"><a href="est.html#cb30-10" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-11"><a href="est.html#cb30-11" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb30-12"><a href="est.html#cb30-12" tabindex="-1"></a>        <span class="at">legend.margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb30-13"><a href="est.html#cb30-13" tabindex="-1"></a>        <span class="at">legend.box.margin=</span><span class="fu">margin</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb30-14"><a href="est.html#cb30-14" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb30-15"><a href="est.html#cb30-15" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb30-16"><a href="est.html#cb30-16" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb30-17"><a href="est.html#cb30-17" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb30-18"><a href="est.html#cb30-18" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-19"><a href="est.html#cb30-19" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-20"><a href="est.html#cb30-20" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;lightgrey&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>),</span>
<span id="cb30-21"><a href="est.html#cb30-21" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-22"><a href="est.html#cb30-22" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb30-23"><a href="est.html#cb30-23" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))<span class="sc">+</span></span>
<span id="cb30-24"><a href="est.html#cb30-24" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)))</span></code></pre></div>
<pre><code>## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf</code></pre>
<div class="figure"><span style="display:block;" id="fig:est7b"></span>
<img src="HMsActivity_files/figure-html/est7b-1.png" alt="Comparison of simulated and estimated probability of activity conditional mean curves with variability in the frequency of site-use from a trigonometric hierarchical model; shading corresponds to 95% confidence intervals." width="672" />
<p class="caption">
Figure 3.2: Comparison of simulated and estimated probability of activity conditional mean curves with variability in the frequency of site-use from a trigonometric hierarchical model; shading corresponds to 95% confidence intervals.
</p>
</div>
<p>The estimated activity pattern from the random intercept-only trigonometric GLMM (in blue) closely resembles the simulated conditional probability (in red) even though we ignored site-to-site variability in the timing of activity.</p>
<p>To allow site-to-site variability in the timing of activity, we can add random slopes to the model. The choice of the structure of the random slope effect is not trivial; we can include only parameters linked to the first cosine term in equation 1 (i.e. first two terms in equation 2), only terms for the second cosine term in equation 2 (i.e. third and forth terms in equation 2) or both. When possible, based on computational time and the information contained in the data, we recommend to include all the terms and allow for the random intercept to vary independently of the random slope<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. In <code>GLMMadaptive</code>, we ensure this independence by using the syntax || when specifying the random effect component of the model. In Table 2 in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>, we provide guidance on the code syntax needed to run the equivalent model and the other models presented throughout the tutorial with other R packages.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="est.html#cb32-1" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb32-2"><a href="est.html#cb32-2" tabindex="-1"></a>trig_rand_slope <span class="ot">&lt;-</span> <span class="fu">mixed_model</span>(<span class="at">fixed =</span> <span class="fu">cbind</span>(success, failure) <span class="sc">~</span> </span>
<span id="cb32-3"><a href="est.html#cb32-3" tabindex="-1"></a>                                  <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="est.html#cb32-4" tabindex="-1"></a>                                  <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>),</span>
<span id="cb32-5"><a href="est.html#cb32-5" tabindex="-1"></a>                               <span class="at">random =</span> <span class="sc">~</span>  <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="est.html#cb32-6" tabindex="-1"></a>                                        <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">||</span>   Site,</span>
<span id="cb32-7"><a href="est.html#cb32-7" tabindex="-1"></a>                               <span class="at">data =</span> occasions_cbind, </span>
<span id="cb32-8"><a href="est.html#cb32-8" tabindex="-1"></a>                               <span class="at">family =</span> <span class="fu">binomial</span>(), </span>
<span id="cb32-9"><a href="est.html#cb32-9" tabindex="-1"></a>                               <span class="at">iter_EM =</span> <span class="dv">0</span></span>
<span id="cb32-10"><a href="est.html#cb32-10" tabindex="-1"></a>                               )</span>
<span id="cb32-11"><a href="est.html#cb32-11" tabindex="-1"></a></span>
<span id="cb32-12"><a href="est.html#cb32-12" tabindex="-1"></a><span class="fu">summary</span>(trig_rand_slope)</span></code></pre></div>
<pre><code>## 
## Call:
## mixed_model(fixed = cbind(success, failure) ~ cos(2 * pi * Time/24) + 
##     sin(2 * pi * Time/24) + cos(2 * pi * Time/12) + sin(2 * pi * 
##     Time/12), random = ~cos(2 * pi * Time/24) + sin(2 * pi * 
##     Time/24) + cos(2 * pi * Time/12) + sin(2 * pi * Time/12) || 
##     Site, data = occasions_cbind, family = binomial(), iter_EM = 0)
## 
## Data Descriptives:
## Number of Observations: 2400
## Number of Groups: 100 
## 
## Model:
##  family: binomial
##  link: logit 
## 
## Fit statistics:
##    log.Lik      AIC      BIC
##  -3704.187 7428.374 7454.425
## 
## Random effects covariance matrix:
##                       StdDev
## (Intercept)           0.9742
## cos(2 * pi * Time/24) 0.0307
## sin(2 * pi * Time/24) 0.2343
## cos(2 * pi * Time/12) 0.1913
## sin(2 * pi * Time/12) 0.0430
## 
## Fixed effects:
##                       Estimate Std.Err  z-value p-value
## (Intercept)            -3.0888  0.1000 -30.8945 &lt; 1e-04
## cos(2 * pi * Time/24)  -0.9410  0.0268 -35.1529 &lt; 1e-04
## sin(2 * pi * Time/24)  -0.1584  0.0345  -4.5927 &lt; 1e-04
## cos(2 * pi * Time/12)  -0.2659  0.0315  -8.4323 &lt; 1e-04
## sin(2 * pi * Time/12)  -0.5988  0.0237 -25.2223 &lt; 1e-04
## 
## Integration:
## method: adaptive Gauss-Hermite quadrature rule
## quadrature points: 7
## 
## Optimization:
## method: quasi-Newton
## converged: TRUE</code></pre>
<p>As before, we visually inspect the estimated conditional mean activity pattern based on this model and compare it with the simulated conditional mean activity pattern.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="est.html#cb34-1" tabindex="-1"></a><span class="co"># estimated activity pattern</span></span>
<span id="cb34-2"><a href="est.html#cb34-2" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">with</span>(occasions_cbind, <span class="fu">expand.grid</span>(<span class="at">Time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(Time), <span class="dv">24</span>, <span class="at">length.out =</span> <span class="dv">48</span>)))</span>
<span id="cb34-3"><a href="est.html#cb34-3" tabindex="-1"></a>cond_eff1 <span class="ot">&lt;-</span> <span class="fu">effectPlotData</span>(trig_rand_slope, newdat, <span class="at">marginal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="est.html#cb34-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">plogis</span>(pred),</span>
<span id="cb34-5"><a href="est.html#cb34-5" tabindex="-1"></a>         <span class="at">low =</span> <span class="fu">plogis</span>(low),</span>
<span id="cb34-6"><a href="est.html#cb34-6" tabindex="-1"></a>         <span class="at">upp =</span> <span class="fu">plogis</span>(upp),</span>
<span id="cb34-7"><a href="est.html#cb34-7" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Estimated: Random Intercept and Slope&quot;</span>)</span>
<span id="cb34-8"><a href="est.html#cb34-8" tabindex="-1"></a></span>
<span id="cb34-9"><a href="est.html#cb34-9" tabindex="-1"></a><span class="co"># simulated conditional activity pattern</span></span>
<span id="cb34-10"><a href="est.html#cb34-10" tabindex="-1"></a>cond_true <span class="ot">&lt;-</span> dat<span class="sc">$</span>Conditional <span class="sc">%&gt;%</span> </span>
<span id="cb34-11"><a href="est.html#cb34-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb34-12"><a href="est.html#cb34-12" tabindex="-1"></a>         <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb34-13"><a href="est.html#cb34-13" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Simulated Conditional&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="est.html#cb34-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Time =</span> time, <span class="at">pred =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="est.html#cb34-15" tabindex="-1"></a>  <span class="fu">select</span>(Time, pred, low, upp, Mod)</span>
<span id="cb34-16"><a href="est.html#cb34-16" tabindex="-1"></a></span>
<span id="cb34-17"><a href="est.html#cb34-17" tabindex="-1"></a><span class="co"># combine the two for visualization  purposes</span></span>
<span id="cb34-18"><a href="est.html#cb34-18" tabindex="-1"></a>cond_eff <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cond_true, cond_eff1)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb35-1"><a href="est.html#cb35-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb35-2"><a href="est.html#cb35-2" tabindex="-1"></a>(pl_trig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cond_eff, <span class="fu">aes</span>(Time, pred)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="est.html#cb35-3" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, <span class="at">color =</span> Mod, <span class="at">fill =</span> Mod), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span> <span class="co">#</span></span>
<span id="cb35-4"><a href="est.html#cb35-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Mod), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#</span></span>
<span id="cb35-5"><a href="est.html#cb35-5" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb35-6"><a href="est.html#cb35-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="est.html#cb35-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day (Hour)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Predicted Activity Pattern </span><span class="sc">\n</span><span class="st"> (probability)&quot;</span>, </span>
<span id="cb35-8"><a href="est.html#cb35-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Estimated vs Simulated Activity Patterns&quot;</span></span>
<span id="cb35-9"><a href="est.html#cb35-9" tabindex="-1"></a>       )<span class="sc">+</span></span>
<span id="cb35-10"><a href="est.html#cb35-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-11"><a href="est.html#cb35-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb35-12"><a href="est.html#cb35-12" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-13"><a href="est.html#cb35-13" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb35-14"><a href="est.html#cb35-14" tabindex="-1"></a>        <span class="at">legend.margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb35-15"><a href="est.html#cb35-15" tabindex="-1"></a>        <span class="at">legend.box.margin=</span><span class="fu">margin</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb35-16"><a href="est.html#cb35-16" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb35-17"><a href="est.html#cb35-17" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb35-18"><a href="est.html#cb35-18" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb35-19"><a href="est.html#cb35-19" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb35-20"><a href="est.html#cb35-20" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-21"><a href="est.html#cb35-21" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-22"><a href="est.html#cb35-22" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;lightgrey&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>),</span>
<span id="cb35-23"><a href="est.html#cb35-23" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-24"><a href="est.html#cb35-24" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb35-25"><a href="est.html#cb35-25" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb35-26"><a href="est.html#cb35-26" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb35-27"><a href="est.html#cb35-27" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>))</span>
<span id="cb35-28"><a href="est.html#cb35-28" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="HMsActivity_files/figure-html/unnamed-chunk-1-1.png" alt="Comparison of simulated and estimated probability of activity conditional mean curve with variability in the frequency of site-use and timing of activity from a trigonometric hierarchical model; shading corresponds to 95% confidence intervals." width="672" />
<p class="caption">
Figure 3.3: Comparison of simulated and estimated probability of activity conditional mean curve with variability in the frequency of site-use and timing of activity from a trigonometric hierarchical model; shading corresponds to 95% confidence intervals.
</p>
</div>
<p>Again, the estimated activity curve closely matches the true activity that was used to generate the data. In this case, adding a random slope improved the estimates only marginally. This will often be the case when there is only a low level of variation in the timing of activity across sites <span class="citation">(<a href="references.html#ref-Iannarilli2020">Iannarilli 2020</a>)</span>, as occurs in the data we simulated. In section <a href="cov.html#cat">6.1</a>, we consider an example in which modelling variability in the timing of activity reveals interesting site-to-site differences in activity patterns.</p>
</div>
<div id="cyclic-cubic-spline-hgams" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Cyclic cubic spline HGAMs<a href="est.html#cyclic-cubic-spline-hgams" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we illustrate how cyclic cubic spline HGAMs can be used to explore activity patterns. HGAMs, of which cyclic cubic spline hierarchical models are a special case, are complex functions that allow analysts to model non-linear relationships. These models are highly flexible, often computationally intensive for large datasets, and can be used to model a wide array of model structures and related hypotheses. This high flexibility can make these models intimidating at first. A complete review of the different proprieties of these models is beyond the scope of this work (but see <span class="citation">Pedersen et al. (<a href="references.html#ref-Pedersen2019">2019</a>)</span> and <span class="citation">N. (<a href="references.html#ref-Wood2017">2017</a>)</span>). Here, we present two model structures that, in our opinion, are useful when addressing the most common ecological questions related to activity patterns.</p>
<p>We fit a cyclic cubic spline hierarchical model using the <code>bam</code> function in package <code>mgcv</code> <span class="citation">(<a href="references.html#ref-Wood2017">N. 2017</a>)</span>. We start with a model that resembles a trigonometric random intercept-only model. We use the argument <code>bs="re"</code> in the smoother <code>s(Site, bs="re")</code> to specify <code>Site</code> as a random intercept. We also have a cyclic cubic smoother for <code>Time</code> that accommodates the periodicity in the data. As before, we run the model, predict the estimated activity pattern using the <code>predict.bam</code> function available in the <code>mgcv</code> package <span class="citation">(<a href="references.html#ref-Wood2017">N. 2017</a>)</span>, and visually compare it with the simulated conditional mean activity pattern.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="est.html#cb37-1" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb37-2"><a href="est.html#cb37-2" tabindex="-1"></a>cycl_rand_int <span class="ot">&lt;-</span> <span class="fu">bam</span>(<span class="fu">cbind</span>(success, failure) <span class="sc">~</span> <span class="fu">s</span>(Time, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>, <span class="at">k =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb37-3"><a href="est.html#cb37-3" tabindex="-1"></a>                                               <span class="fu">s</span>(Site, <span class="at">bs=</span><span class="st">&quot;re&quot;</span>), </span>
<span id="cb37-4"><a href="est.html#cb37-4" tabindex="-1"></a>                                               <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb37-5"><a href="est.html#cb37-5" tabindex="-1"></a>                                               <span class="at">data =</span> occasions_cbind, </span>
<span id="cb37-6"><a href="est.html#cb37-6" tabindex="-1"></a>                                               <span class="at">knots =</span> <span class="fu">list</span>(<span class="at">Time=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">23</span>))</span>
<span id="cb37-7"><a href="est.html#cb37-7" tabindex="-1"></a>                     ) </span>
<span id="cb37-8"><a href="est.html#cb37-8" tabindex="-1"></a><span class="fu">summary</span>(cycl_rand_int)</span></code></pre></div>
<pre><code>## 
## Family: binomial 
## Link function: logit 
## 
## Formula:
## cbind(success, failure) ~ s(Time, bs = &quot;cc&quot;, k = 12) + s(Site, 
##     bs = &quot;re&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.04745    0.09894   -30.8   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df Chi.sq p-value    
## s(Time)  9.066     10   3094  &lt;2e-16 ***
## s(Site) 95.262     99   3687  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =   0.76   Deviance explained = 70.6%
## fREML =   3722  Scale est. = 1         n = 2400</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="est.html#cb39-1" tabindex="-1"></a><span class="co"># build estimated activity curves</span></span>
<span id="cb39-2"><a href="est.html#cb39-2" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">with</span>(occasions_cbind, </span>
<span id="cb39-3"><a href="est.html#cb39-3" tabindex="-1"></a>               <span class="fu">expand.grid</span>(<span class="at">Time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(Time), <span class="fu">max</span>(Time), <span class="dv">1</span>),</span>
<span id="cb39-4"><a href="est.html#cb39-4" tabindex="-1"></a>                           <span class="at">Site =</span> <span class="st">&quot;A1&quot;</span>) <span class="co">#Site doesn&#39;t matter</span></span>
<span id="cb39-5"><a href="est.html#cb39-5" tabindex="-1"></a>               ) </span>
<span id="cb39-6"><a href="est.html#cb39-6" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">predict.bam</span>(cycl_rand_int, <span class="at">newdata =</span> newdat,  <span class="at">exclude =</span> <span class="st">&quot;s(Site)&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) </span>
<span id="cb39-7"><a href="est.html#cb39-7" tabindex="-1"></a>cycl_pred <span class="ot">&lt;-</span> newdat  <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="est.html#cb39-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> temp<span class="sc">$</span>fit,</span>
<span id="cb39-9"><a href="est.html#cb39-9" tabindex="-1"></a>         <span class="at">low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>temp<span class="sc">$</span>se.fit,</span>
<span id="cb39-10"><a href="est.html#cb39-10" tabindex="-1"></a>         <span class="at">upp =</span> pred <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>temp<span class="sc">$</span>se.fit,</span>
<span id="cb39-11"><a href="est.html#cb39-11" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Estimated: Random Intercept-only&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-12"><a href="est.html#cb39-12" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Site)</span>
<span id="cb39-13"><a href="est.html#cb39-13" tabindex="-1"></a></span>
<span id="cb39-14"><a href="est.html#cb39-14" tabindex="-1"></a><span class="co"># combine true and estimated curves for visualization  purposes</span></span>
<span id="cb39-15"><a href="est.html#cb39-15" tabindex="-1"></a>cond_eff <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cond_true, cycl_pred)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb40-1"><a href="est.html#cb40-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb40-2"><a href="est.html#cb40-2" tabindex="-1"></a>(pl_cycl1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cond_eff, <span class="fu">aes</span>(Time, pred)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="est.html#cb40-3" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, <span class="at">color =</span> Mod, <span class="at">fill =</span> Mod), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb40-4"><a href="est.html#cb40-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Mod), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb40-5"><a href="est.html#cb40-5" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="est.html#cb40-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb40-7"><a href="est.html#cb40-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day (Hour)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Predicted Activity Pattern </span><span class="sc">\n</span><span class="st"> (probability)&quot;</span>, </span>
<span id="cb40-8"><a href="est.html#cb40-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Estimated vs Simulated Activity Patterns&quot;</span></span>
<span id="cb40-9"><a href="est.html#cb40-9" tabindex="-1"></a>       )<span class="sc">+</span></span>
<span id="cb40-10"><a href="est.html#cb40-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb40-11"><a href="est.html#cb40-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb40-12"><a href="est.html#cb40-12" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-13"><a href="est.html#cb40-13" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb40-14"><a href="est.html#cb40-14" tabindex="-1"></a>        <span class="at">legend.margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb40-15"><a href="est.html#cb40-15" tabindex="-1"></a>        <span class="at">legend.box.margin=</span><span class="fu">margin</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb40-16"><a href="est.html#cb40-16" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb40-17"><a href="est.html#cb40-17" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb40-18"><a href="est.html#cb40-18" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb40-19"><a href="est.html#cb40-19" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb40-20"><a href="est.html#cb40-20" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-21"><a href="est.html#cb40-21" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-22"><a href="est.html#cb40-22" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;lightgrey&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>),</span>
<span id="cb40-23"><a href="est.html#cb40-23" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-24"><a href="est.html#cb40-24" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb40-25"><a href="est.html#cb40-25" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb40-26"><a href="est.html#cb40-26" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb40-27"><a href="est.html#cb40-27" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>))</span>
<span id="cb40-28"><a href="est.html#cb40-28" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf</code></pre>
<div class="figure"><span style="display:block;" id="fig:est10b"></span>
<img src="HMsActivity_files/figure-html/est10b-1.png" alt="Comparison of simulated and HGAM estimated probability of activity conditional mean curves with variability in the frequency of site-use; shading corresponds to 95% confidence intervals." width="672" />
<p class="caption">
Figure 3.4: Comparison of simulated and HGAM estimated probability of activity conditional mean curves with variability in the frequency of site-use; shading corresponds to 95% confidence intervals.
</p>
</div>
<p>This model corresponds, in general terms, to the trigonometric random intercept-only model we ran earlier. Thus, it only accommodates variability in the frequency of site-use and not in the timing of activity. The model again captures the general shape of the simulated conditional mean activity curve.</p>
<p>We can add complexity and include a smoother that shrinks the site-specific estimates toward a common smooth and one that allows curves to vary among sites. This model structure resembles the random slope component in trigonometric random intercept and random slope models and allows the site-specific estimates to vary also in the timing of activity. In <code>mgcv</code>, there is no need to explicitly force the independence between the random intercept and the random slope (as done before for the trigonometric hierarchical models) because there is no covariance term between two random effects.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="est.html#cb42-1" tabindex="-1"></a><span class="co"># Fit model with general smoother for Time</span></span>
<span id="cb42-2"><a href="est.html#cb42-2" tabindex="-1"></a>cycl_rand_slope <span class="ot">&lt;-</span> <span class="fu">bam</span>(<span class="fu">cbind</span>(success, failure) <span class="sc">~</span> </span>
<span id="cb42-3"><a href="est.html#cb42-3" tabindex="-1"></a>                       <span class="fu">s</span>(Time, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>, <span class="at">k =</span> <span class="dv">12</span>) <span class="sc">+</span> <span class="co"># general smoother</span></span>
<span id="cb42-4"><a href="est.html#cb42-4" tabindex="-1"></a>                       <span class="fu">s</span>(Time, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>, <span class="at">k =</span> <span class="dv">12</span>, <span class="at">by =</span> Site, <span class="at">m =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="est.html#cb42-5" tabindex="-1"></a>                       <span class="fu">s</span>(Site, <span class="at">bs=</span><span class="st">&quot;re&quot;</span>), </span>
<span id="cb42-6"><a href="est.html#cb42-6" tabindex="-1"></a>                       <span class="at">knots =</span> <span class="fu">list</span>(<span class="at">Time=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">23</span>)),</span>
<span id="cb42-7"><a href="est.html#cb42-7" tabindex="-1"></a>                       <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb42-8"><a href="est.html#cb42-8" tabindex="-1"></a>                       <span class="at">data =</span> occasions_cbind</span>
<span id="cb42-9"><a href="est.html#cb42-9" tabindex="-1"></a>                       )</span>
<span id="cb42-10"><a href="est.html#cb42-10" tabindex="-1"></a><span class="fu">summary</span>(cycl_rand_slope)</span></code></pre></div>
<pre><code>## 
## Family: binomial 
## Link function: logit 
## 
## Formula:
## cbind(success, failure) ~ s(Time, bs = &quot;cc&quot;, k = 12) + s(Time, 
##     bs = &quot;cc&quot;, k = 12, by = Site, m = 1) + s(Site, bs = &quot;re&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.05918    0.09874  -30.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                        edf Ref.df   Chi.sq p-value    
## s(Time)          9.061e+00     10 2583.131  &lt;2e-16 ***
## s(Time):SiteA1   4.371e-01     10    0.562  0.3830    
## s(Time):SiteA10  2.003e-06     10    0.000  0.7101    
## s(Time):SiteA100 1.420e+00     10    3.306  0.4797    
## s(Time):SiteA11  1.797e-06     10    0.000  0.5936    
## s(Time):SiteA12  1.832e-06     10    0.000  0.7132    
## s(Time):SiteA13  1.639e+00     10    9.885  0.2819    
## s(Time):SiteA14  1.527e-06     10    0.000  0.5203    
## s(Time):SiteA15  2.331e+00     10   42.828  0.0452 *  
## s(Time):SiteA16  2.205e-06     10    0.000  0.5133    
## s(Time):SiteA17  8.433e-01     10    3.353  0.1922    
## s(Time):SiteA18  2.039e-06     10    0.000  0.7737    
## s(Time):SiteA19  3.553e+00     10   62.047  0.0412 *  
## s(Time):SiteA2   3.703e-06     10    0.000  0.5109    
## s(Time):SiteA20  3.998e+00     10   31.694  0.2002    
## s(Time):SiteA21  4.114e+00     10   46.728  0.0393 *  
## s(Time):SiteA22  1.198e-06     10    0.000  0.7510    
## s(Time):SiteA23  7.953e-06     10    0.000  0.4636    
## s(Time):SiteA24  9.795e-01     10    1.770  0.4597    
## s(Time):SiteA25  3.840e-06     10    0.000  0.4801    
## s(Time):SiteA26  2.197e+00     10  111.557  0.0144 *  
## s(Time):SiteA27  9.035e-07     10    0.000  0.9599    
## s(Time):SiteA28  2.784e-06     10    0.000  0.5393    
## s(Time):SiteA29  3.745e+00     10   33.511  0.1217    
## s(Time):SiteA3   5.584e-06     10    0.000  0.3965    
## s(Time):SiteA30  9.305e-07     10    0.000  0.9744    
## s(Time):SiteA31  2.444e-06     10    0.000  0.5635    
## s(Time):SiteA32  4.038e-02     10    0.045  0.3373    
## s(Time):SiteA33  2.085e-06     10    0.000  0.7380    
## s(Time):SiteA34  2.818e-06     10    0.000  0.5247    
## s(Time):SiteA35  1.054e-06     10    0.000  0.9977    
## s(Time):SiteA36  2.531e-01     10    0.357  0.3264    
## s(Time):SiteA37  4.911e-06     10    0.000  0.4435    
## s(Time):SiteA38  1.429e+00     10    5.344  0.3602    
## s(Time):SiteA39  1.353e-06     10    0.000  0.8886    
## s(Time):SiteA4   1.213e-06     10    0.000  0.8443    
## s(Time):SiteA40  3.242e-01     10    0.513  0.2930    
## s(Time):SiteA41  2.556e-01     10    0.415  0.2784    
## s(Time):SiteA42  1.115e+00     10    2.887  0.3039    
## s(Time):SiteA43  2.661e-06     10    0.000  0.5941    
## s(Time):SiteA44  1.061e-06     10    0.000  0.5674    
## s(Time):SiteA45  9.063e-03     10    0.009  0.3550    
## s(Time):SiteA46  9.732e-01     10    4.958  0.1412    
## s(Time):SiteA47  2.472e-02     10    0.027  0.3410    
## s(Time):SiteA48  1.970e-06     10    0.000  0.6506    
## s(Time):SiteA49  1.070e-06     10    0.000  0.9658    
## s(Time):SiteA5   8.967e-07     10    0.000  0.7955    
## s(Time):SiteA50  1.559e+00     10    5.293  0.0700 .  
## s(Time):SiteA51  3.052e-06     10    0.000  0.5682    
## s(Time):SiteA52  7.708e-07     10    0.000  0.8218    
## s(Time):SiteA53  1.784e+00     10   19.804  0.1444    
## s(Time):SiteA54  8.030e-06     10    0.000  0.4270    
## s(Time):SiteA55  1.913e-06     10    0.000  0.5856    
## s(Time):SiteA56  9.627e-01     10   12.752  0.0569 .  
## s(Time):SiteA57  9.381e-01     10    6.027  0.1786    
## s(Time):SiteA58  1.025e-06     10    0.000  0.9562    
## s(Time):SiteA59  7.248e-01     10    1.168  0.5292    
## s(Time):SiteA6   4.144e+00     10   49.389  0.1140    
## s(Time):SiteA60  1.565e-06     10    0.000  0.8538    
## s(Time):SiteA61  1.103e-06     10    0.000  0.9148    
## s(Time):SiteA62  2.243e-06     10    0.000  0.5242    
## s(Time):SiteA63  1.178e-05     10    0.000  0.4258    
## s(Time):SiteA64  2.117e+00     10   62.976  0.0260 *  
## s(Time):SiteA65  2.724e+00     10   37.437  0.0981 .  
## s(Time):SiteA66  1.809e+00     10   15.902  0.1948    
## s(Time):SiteA67  1.534e-06     10    0.000  0.7535    
## s(Time):SiteA68  2.834e-06     10    0.000  0.5173    
## s(Time):SiteA69  2.151e-01     10    0.257  0.3358    
## s(Time):SiteA7   4.642e-06     10    0.000  0.4472    
## s(Time):SiteA70  4.617e-01     10    2.428  0.1073    
## s(Time):SiteA71  1.383e-06     10    0.000  0.5298    
## s(Time):SiteA72  9.419e-01     10    2.310  0.2210    
## s(Time):SiteA73  4.981e-06     10    0.000  0.5110    
## s(Time):SiteA74  6.739e-02     10    0.072  0.3742    
## s(Time):SiteA75  1.080e-01     10    0.156  0.3083    
## s(Time):SiteA76  5.645e-01     10    0.855  0.4055    
## s(Time):SiteA77  9.215e-07     10    0.000  0.6584    
## s(Time):SiteA78  1.210e+00     10    3.184  0.3880    
## s(Time):SiteA79  1.114e+00     10    4.934  0.2169    
## s(Time):SiteA8   7.637e-07     10    0.000  0.6840    
## s(Time):SiteA80  2.614e+00     10   11.273  0.3388    
## s(Time):SiteA81  2.436e-03     10    0.002  0.3616    
## s(Time):SiteA82  7.592e-01     10    1.556  0.3970    
## s(Time):SiteA83  1.134e+00     10   13.496  0.0943 .  
## s(Time):SiteA84  9.353e-06     10    0.000  0.4141    
## s(Time):SiteA85  2.802e-06     10    0.000  0.4922    
## s(Time):SiteA86  2.003e+00     10   11.026  0.2890    
## s(Time):SiteA87  2.833e-06     10    0.000  0.6427    
## s(Time):SiteA88  2.636e-06     10    0.000  0.8619    
## s(Time):SiteA89  1.315e+00     10    5.537  0.2723    
## s(Time):SiteA9   1.040e+00     10    2.502  0.4632    
## s(Time):SiteA90  1.151e+00     10   20.161  0.0376 *  
## s(Time):SiteA91  1.381e-06     10    0.000  0.8268    
## s(Time):SiteA92  1.346e-06     10    0.000  0.9748    
## s(Time):SiteA93  9.053e-07     10    0.000  0.8641    
## s(Time):SiteA94  3.807e-02     10    0.039  0.3685    
## s(Time):SiteA95  6.342e-01     10    2.482  0.1206    
## s(Time):SiteA96  3.957e-06     10    0.000  0.5196    
## s(Time):SiteA97  5.507e-06     10    0.000  0.4437    
## s(Time):SiteA98  1.013e-06     10    0.000  0.7219    
## s(Time):SiteA99  2.401e+00     10   23.757  0.0874 .  
## s(Site)          9.506e+01     99 3527.045  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.794   Deviance explained = 73.8%
## fREML = 3656.1  Scale est. = 1         n = 2400</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="est.html#cb44-1" tabindex="-1"></a><span class="co"># build the estimated activity patterns</span></span>
<span id="cb44-2"><a href="est.html#cb44-2" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">with</span>(occasions_cbind, </span>
<span id="cb44-3"><a href="est.html#cb44-3" tabindex="-1"></a>               <span class="fu">expand.grid</span>(<span class="at">Time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(Time), <span class="fu">max</span>(Time), <span class="dv">1</span>), </span>
<span id="cb44-4"><a href="est.html#cb44-4" tabindex="-1"></a>                           <span class="at">Site =</span> <span class="st">&quot;A1&quot;</span> <span class="co">#Site doesn&#39;t matter</span></span>
<span id="cb44-5"><a href="est.html#cb44-5" tabindex="-1"></a>                           )  </span>
<span id="cb44-6"><a href="est.html#cb44-6" tabindex="-1"></a>               )</span>
<span id="cb44-7"><a href="est.html#cb44-7" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">predict.bam</span>(cycl_rand_slope, </span>
<span id="cb44-8"><a href="est.html#cb44-8" tabindex="-1"></a>                    <span class="at">newdata =</span> newdat,  </span>
<span id="cb44-9"><a href="est.html#cb44-9" tabindex="-1"></a>                    <span class="at">exclude =</span> <span class="st">&quot;s(Site)&quot;</span>, </span>
<span id="cb44-10"><a href="est.html#cb44-10" tabindex="-1"></a>                    <span class="at">se.fit =</span> <span class="cn">TRUE</span>, </span>
<span id="cb44-11"><a href="est.html#cb44-11" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb44-12"><a href="est.html#cb44-12" tabindex="-1"></a>                    )</span>
<span id="cb44-13"><a href="est.html#cb44-13" tabindex="-1"></a></span>
<span id="cb44-14"><a href="est.html#cb44-14" tabindex="-1"></a>cycl_pred <span class="ot">&lt;-</span> newdat  <span class="sc">%&gt;%</span> </span>
<span id="cb44-15"><a href="est.html#cb44-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> temp<span class="sc">$</span>fit,</span>
<span id="cb44-16"><a href="est.html#cb44-16" tabindex="-1"></a>         <span class="at">low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>temp<span class="sc">$</span>se.fit,</span>
<span id="cb44-17"><a href="est.html#cb44-17" tabindex="-1"></a>         <span class="at">upp =</span> pred <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>temp<span class="sc">$</span>se.fit,</span>
<span id="cb44-18"><a href="est.html#cb44-18" tabindex="-1"></a>         <span class="at">Mod =</span> <span class="st">&quot;Estimated: Random Slope&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-19"><a href="est.html#cb44-19" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Site)</span>
<span id="cb44-20"><a href="est.html#cb44-20" tabindex="-1"></a></span>
<span id="cb44-21"><a href="est.html#cb44-21" tabindex="-1"></a><span class="co"># combine the true and estimated curves for visualization  purposes</span></span>
<span id="cb44-22"><a href="est.html#cb44-22" tabindex="-1"></a>cond_eff <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cond_true, cycl_pred)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb45-1"><a href="est.html#cb45-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb45-2"><a href="est.html#cb45-2" tabindex="-1"></a>(pl_cycl2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cond_eff, <span class="fu">aes</span>(Time, pred)) <span class="sc">+</span></span>
<span id="cb45-3"><a href="est.html#cb45-3" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, <span class="at">color =</span> Mod, <span class="at">fill =</span> Mod), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span> <span class="co">#</span></span>
<span id="cb45-4"><a href="est.html#cb45-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Mod), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#</span></span>
<span id="cb45-5"><a href="est.html#cb45-5" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="est.html#cb45-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-7"><a href="est.html#cb45-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day (Hour)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Predicted Activity Pattern </span><span class="sc">\n</span><span class="st"> (probability)&quot;</span>, </span>
<span id="cb45-8"><a href="est.html#cb45-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Estimated vs Simulated Activity Patterns&quot;</span></span>
<span id="cb45-9"><a href="est.html#cb45-9" tabindex="-1"></a>       )<span class="sc">+</span></span>
<span id="cb45-10"><a href="est.html#cb45-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb45-11"><a href="est.html#cb45-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb45-12"><a href="est.html#cb45-12" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-13"><a href="est.html#cb45-13" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb45-14"><a href="est.html#cb45-14" tabindex="-1"></a>        <span class="at">legend.margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb45-15"><a href="est.html#cb45-15" tabindex="-1"></a>        <span class="at">legend.box.margin=</span><span class="fu">margin</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb45-16"><a href="est.html#cb45-16" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb45-17"><a href="est.html#cb45-17" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb45-18"><a href="est.html#cb45-18" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb45-19"><a href="est.html#cb45-19" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb45-20"><a href="est.html#cb45-20" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-21"><a href="est.html#cb45-21" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-22"><a href="est.html#cb45-22" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;lightgrey&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>),</span>
<span id="cb45-23"><a href="est.html#cb45-23" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-24"><a href="est.html#cb45-24" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb45-25"><a href="est.html#cb45-25" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))<span class="sc">+</span></span>
<span id="cb45-26"><a href="est.html#cb45-26" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)))</span></code></pre></div>
<pre><code>## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf</code></pre>
<div class="figure"><span style="display:block;" id="fig:est11b"></span>
<img src="HMsActivity_files/figure-html/est11b-1.png" alt="Comparison of simulated and HGAM estimated probability of activity conditional mean curves with variability in the frequency of site-use and timing of activity; shading corresponds to 95% confidence intervals." width="672" />
<p class="caption">
Figure 3.5: Comparison of simulated and HGAM estimated probability of activity conditional mean curves with variability in the frequency of site-use and timing of activity; shading corresponds to 95% confidence intervals.
</p>
</div>
<p>Adding a component that allows for variability in timing of activity seems to improve the model fit and provides an estimated activity pattern that more closely resembles the one used to simulated the data.</p>
<p><strong>Going forward</strong>. Throughout the tutorial, we fit trigonometric GLMMs using a binomial distribution (<code>family = "binomial"</code> in the code); however, we can run these models also using a Poisson distribution with a few adjustments to data and model structures. We report an example in section <a href="app.html#poisson">10.2</a>. When working with large datasets, using a Poisson distribution might result in lower computational times.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>By allowing these terms to vary independently, we eliminate the need to estimate several covariance terms, which may be difficult with small numbers of sites.<a href="est.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="var.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dataprep.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
