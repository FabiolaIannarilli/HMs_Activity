<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tutorial 8 Conditional and marginal mean activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</title>
  <meta name="description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Tutorial 8 Conditional and marginal mean activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tutorial 8 Conditional and marginal mean activity patterns | A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models" />
  
  <meta name="twitter:description" content="This document contains how-to tutorials that illustrate the use of hierarchical models for the analysis of activity patterns. It accompanies the manuscript HMsActivity 2024." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="temppart.html"/>
<link rel="next" href="kdes.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="var.html"><a href="var.html"><i class="fa fa-check"></i><b>2</b> Variability in activity patterns</a>
<ul>
<li class="chapter" data-level="2.1" data-path="var.html"><a href="var.html#variability-in-frequency-of-site-use"><i class="fa fa-check"></i><b>2.1</b> Variability in frequency of site-use</a></li>
<li class="chapter" data-level="2.2" data-path="var.html"><a href="var.html#variability-in-timing-of-activity"><i class="fa fa-check"></i><b>2.2</b> Variability in timing of activity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="est.html"><a href="est.html"><i class="fa fa-check"></i><b>3</b> Estimating activity patterns from time-stamped data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="est.html"><a href="est.html#simulating-activity-patterns"><i class="fa fa-check"></i><b>3.1</b> Simulating activity patterns</a></li>
<li class="chapter" data-level="3.2" data-path="est.html"><a href="est.html#data-preparation"><i class="fa fa-check"></i><b>3.2</b> Data preparation</a></li>
<li class="chapter" data-level="3.3" data-path="est.html"><a href="est.html#trigonometric-glmms"><i class="fa fa-check"></i><b>3.3</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="3.4" data-path="est.html"><a href="est.html#cyclic-cubic-spline-hgams"><i class="fa fa-check"></i><b>3.4</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataprep.html"><a href="dataprep.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a></li>
<li class="chapter" data-level="5" data-path="unibim.html"><a href="unibim.html"><i class="fa fa-check"></i><b>5</b> Evaluating hypotheses regarding the shape of activity curves</a></li>
<li class="chapter" data-level="6" data-path="cov.html"><a href="cov.html"><i class="fa fa-check"></i><b>6</b> Modeling activity patterns with covariates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cov.html"><a href="cov.html#cat"><i class="fa fa-check"></i><b>6.1</b> Categorical covariates</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cov.html"><a href="cov.html#trigonometric-glmms-1"><i class="fa fa-check"></i><b>6.1.1</b> Trigonometric GLMMs</a></li>
<li class="chapter" data-level="6.1.2" data-path="cov.html"><a href="cov.html#cyclic-cubic-spline-hgams-1"><i class="fa fa-check"></i><b>6.1.2</b> Cyclic cubic spline HGAMs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cov.html"><a href="cov.html#cont"><i class="fa fa-check"></i><b>6.2</b> Continuous covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="temppart.html"><a href="temppart.html"><i class="fa fa-check"></i><b>7</b> Temporal partitioning</a></li>
<li class="chapter" data-level="8" data-path="condvsmarg.html"><a href="condvsmarg.html"><i class="fa fa-check"></i><b>8</b> Conditional and marginal mean activity patterns</a>
<ul>
<li class="chapter" data-level="8.1" data-path="condvsmarg.html"><a href="condvsmarg.html#estimating-conditional-and-marginal-mean-activity-patterns"><i class="fa fa-check"></i><b>8.1</b> Estimating conditional and marginal mean activity patterns</a></li>
<li class="chapter" data-level="8.2" data-path="condvsmarg.html"><a href="condvsmarg.html#the-frequentist-framework"><i class="fa fa-check"></i><b>8.2</b> The frequentist framework</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="kdes.html"><a href="kdes.html"><i class="fa fa-check"></i><b>9</b> Kernel Density Estimators</a>
<ul>
<li class="chapter" data-level="9.1" data-path="kdes.html"><a href="kdes.html#dataprepkdes"><i class="fa fa-check"></i><b>9.1</b> Data preparation for KDEs</a></li>
<li class="chapter" data-level="9.2" data-path="kdes.html"><a href="kdes.html#kdespkg"><i class="fa fa-check"></i><b>9.2</b> Comparison of KDE estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="kdes.html"><a href="kdes.html#using-the-overlap-package"><i class="fa fa-check"></i><b>9.2.1</b> Using the overlap package</a></li>
<li class="chapter" data-level="9.2.2" data-path="kdes.html"><a href="kdes.html#using-the-activity-package"><i class="fa fa-check"></i><b>9.2.2</b> Using the activity package</a></li>
<li class="chapter" data-level="9.2.3" data-path="kdes.html"><a href="kdes.html#using-the-circular-package"><i class="fa fa-check"></i><b>9.2.3</b> Using the circular package</a></li>
<li class="chapter" data-level="9.2.4" data-path="kdes.html"><a href="kdes.html#comparing-the-results-and-plotting"><i class="fa fa-check"></i><b>9.2.4</b> Comparing the results and plotting</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="kdes.html"><a href="kdes.html#kdedataaggr"><i class="fa fa-check"></i><b>9.3</b> Aggregating <em>versus</em> non-aggregating data in KDEs</a></li>
<li class="chapter" data-level="9.4" data-path="kdes.html"><a href="kdes.html#compkde"><i class="fa fa-check"></i><b>9.4</b> KDEs <em>versus</em> hierarchical models approaches</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="app.html"><a href="app.html"><i class="fa fa-check"></i><b>10</b> Appendix</a>
<ul>
<li class="chapter" data-level="10.1" data-path="app.html"><a href="app.html#simfunction"><i class="fa fa-check"></i><b>10.1</b> The <em>sim_activity</em> function</a></li>
<li class="chapter" data-level="10.2" data-path="app.html"><a href="app.html#poisson"><i class="fa fa-check"></i><b>10.2</b> Binomial versus other distributions</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="app.html"><a href="app.html#data-preparation-1"><i class="fa fa-check"></i><b>10.2.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.2.2" data-path="app.html"><a href="app.html#trigonometric-pdf-comparison"><i class="fa fa-check"></i><b>10.2.2</b> Trigonometric PDF comparison</a></li>
<li class="chapter" data-level="10.2.3" data-path="app.html"><a href="app.html#cyclic-cubic-pdf-comparison"><i class="fa fa-check"></i><b>10.2.3</b> Cyclic cubic PDF comparison</a></li>
<li class="chapter" data-level="10.2.4" data-path="app.html"><a href="app.html#not-controlling-for-sampling-effort"><i class="fa fa-check"></i><b>10.2.4</b> Not controlling for sampling effort</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="app.html"><a href="app.html#bay"><i class="fa fa-check"></i><b>10.3</b> Activity patterns in the Bayesian framework</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="app.html"><a href="app.html#data-preparation-2"><i class="fa fa-check"></i><b>10.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.3.2" data-path="app.html"><a href="app.html#model-setup-and-fitting"><i class="fa fa-check"></i><b>10.3.2</b> Model setup and fitting</a></li>
<li class="chapter" data-level="10.3.3" data-path="app.html"><a href="app.html#model-assessment"><i class="fa fa-check"></i><b>10.3.3</b> Model assessment</a></li>
<li class="chapter" data-level="10.3.4" data-path="app.html"><a href="app.html#model-predictions"><i class="fa fa-check"></i><b>10.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="app.html"><a href="app.html#DielNiche"><i class="fa fa-check"></i><b>10.4</b> Link to the Diel.Niche package</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="app.html"><a href="app.html#data"><i class="fa fa-check"></i><b>10.4.1</b> Data</a></li>
<li class="chapter" data-level="10.4.2" data-path="app.html"><a href="app.html#model-fitting"><i class="fa fa-check"></i><b>10.4.2</b> Model fitting</a></li>
<li class="chapter" data-level="10.4.3" data-path="app.html"><a href="app.html#model-predictions-1"><i class="fa fa-check"></i><b>10.4.3</b> Model predictions</a></li>
<li class="chapter" data-level="10.4.4" data-path="app.html"><a href="app.html#twilight-daytime-and-nighttime"><i class="fa fa-check"></i><b>10.4.4</b> Twilight, daytime, and nighttime</a></li>
<li class="chapter" data-level="10.4.5" data-path="app.html"><a href="app.html#diel.niche"><i class="fa fa-check"></i><b>10.4.5</b> Diel.Niche</a></li>
<li class="chapter" data-level="10.4.6" data-path="app.html"><a href="app.html#conclusion"><i class="fa fa-check"></i><b>10.4.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="app.html"><a href="app.html#info-session"><i class="fa fa-check"></i><b>10.5</b> Info session</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A ‘How-to’ Guide for Estimating Animal Diel Activity Using Hierarchical Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="condvsmarg" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Tutorial 8</span> Conditional and marginal mean activity patterns<a href="condvsmarg.html#condvsmarg" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>GLMMs allow users to estimate both site-specific diel activity patterns and population-level activity patterns formed by averaging activity levels across sites in the population (see Box 1 in <span class="citation">Iannarilli et al. (<a href="references.html#ref-HMsActivity2024">2024</a>)</span>). Site-specific estimates are frequently referred to as <em>conditional means</em> since they are formed by conditioning on a set of site-specific parameters; population-level means are often referred to as <em>marginal means</em>. Although one can estimate the conditional mean associated with any of the sampled sites, it is also common to plot the conditional mean for a ‘typical site’ (i.e. a site with average characteristics), formed by setting all of the random coefficients to their mean values <span class="citation">(<a href="references.html#ref-Fieberg_ea_2009">Fieberg et al. 2009</a>)</span>.</p>
<p>Conditional and marginal mean activity patterns can be estimated in both the frequentist and Bayesian frameworks. The frequentist framework is generally accessible by more users than the Bayesian framework thanks to the availability of many ready-to-use R packages that implement GLMMs, so we first focus on this framework. An example of the same approach in the Bayesian framework is provided in section <a href="app.html#bay">10.3</a>.</p>
<p>We use simulated data to illustrate how random intercept-only and random intercept and slope models are able to return differences in conditional and marginal mean activity patterns.</p>
<p><strong>Data simulation.</strong> Using the approach introduced in Tutorials <a href="var.html#var">2</a> and <a href="est.html#est">3</a>, we simulate encounter events for a species with a bimodal activity pattern using camera traps set at 100 sites with 30 days of sampling at each site. In addition to simulating the data, the <code>sim_activity</code> function also returns the ‘true’ conditional activity pattern for a typical site (one with random effects <span class="math inline">\(\tau_i = 0\)</span> and <span class="math inline">\(\gamma_i = 0\)</span>) at each of 513 equally spaced points <span class="math inline">\(j\)</span> between 0 and 24 hours (i.e. covering the diel activity pattern) using:</p>
<p><span class="math display">\[E[Y_{it} |\tau_i=0,\gamma_i=0] =  \frac{exp^{\beta_0 + \beta_1*\text{cos}(\frac{2\pi t}{24} + \theta_0) + \beta_2*\text{cos}(\frac{2\pi t}{12} + \theta_1)}}{1+exp^{\beta_0 + \beta_1*\text{cos}(\frac{2\pi t}{24} + \theta_0) + \beta_2*\text{cos}(\frac{2\pi t}{12} + \theta_1)}}\]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, <span class="math inline">\(\theta_0\)</span>, and <span class="math inline">\(\theta_1\)</span> correspond to the parameter values used to simulate the data (see Tutorial <a href="est.html#est">3</a>).</p>
<p>In addition, the <code>sim_activity</code> function returns the ‘true’ marginal mean activity pattern, which is formed by averaging activity patterns across sites. To determine marginal means, we have to integrate over the distribution of the random effects:</p>
<p><span class="math display">\[E[Y_{t}] =  \left[\int_{-\infty}^{\infty}\int_{-\infty}^{\infty} \frac{\exp^{\beta_0 + \beta_1\text{cos}(\frac{2\pi t}{24} + (\theta_0 + \gamma_i)) + \beta_2\text{cos}(\frac{2\pi t}{12} + (\theta_1 + \gamma_i))+ \tau_i}}{1+\exp^{\beta_0 + \beta_1\text{cos}(\frac{2\pi t}{24} + (\theta_0+\gamma_i)) + \beta_2\text{cos}(\frac{2\pi t}{12} + (\theta_1+\gamma_i))+ \tau_i}} \frac{\exp^{\frac{-\tau^{2}}{2\sigma_{\tau}^2}}}{\sqrt{2\pi}\sigma_{\tau}} \frac{\exp^{\frac{-\gamma^{2}}{2\sigma_{\gamma}^2}}}{\sqrt{2\pi}\sigma_{\gamma}} \; d\tau d\gamma\right]\]</span>
Because this set of integrals has no closed-form solution, we must use approximation methods to solve for <span class="math inline">\(E[Y_t]\)</span>. In Tutorial <a href="var.html#var">2</a>, we used the <code>integrate</code> function to approximate <span class="math inline">\(E[Y_t]\)</span>. Alternatively, the <code>sim_activity</code> function estimates the marginal mean curve using a simulation approach in which it randomly selects 100,000 sites and their associated values of <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\gamma_i\)</span>, determines site-specific activity patterns for these sites on the probability scale, and then averages these site-specific activity patterns at each of the 513 reference points <span class="math inline">\(j\)</span> between 0 and 23 hours.</p>
<p>If we plot the estimated conditional and marginal mean activity curves (Figure <a href="condvsmarg.html#fig:condvsmarg1">8.1</a>), we see that for this set of parameter values, the two means have a similar shape. However, marginal mean is higher than the conditional mean, suggesting a higher level of overall activity when measured at the population level compared to the activity level at a typical site.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="condvsmarg.html#cb156-1" tabindex="-1"></a><span class="co"># Load libraries and function to simulate activity patterns</span></span>
<span id="cb156-2"><a href="condvsmarg.html#cb156-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb156-3"><a href="condvsmarg.html#cb156-3" tabindex="-1"></a><span class="fu">library</span>(GLMMadaptive)</span>
<span id="cb156-4"><a href="condvsmarg.html#cb156-4" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb156-5"><a href="condvsmarg.html#cb156-5" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb156-6"><a href="condvsmarg.html#cb156-6" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;source_functions/sim_activity.R&quot;</span>)</span>
<span id="cb156-7"><a href="condvsmarg.html#cb156-7" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;source_functions/sim_to_minute.R&quot;</span>)</span>
<span id="cb156-8"><a href="condvsmarg.html#cb156-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">129</span>)</span>
<span id="cb156-9"><a href="condvsmarg.html#cb156-9" tabindex="-1"></a></span>
<span id="cb156-10"><a href="condvsmarg.html#cb156-10" tabindex="-1"></a><span class="co"># Set equations&#39; parameters</span></span>
<span id="cb156-11"><a href="condvsmarg.html#cb156-11" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb156-12"><a href="condvsmarg.html#cb156-12" tabindex="-1"></a>J <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb156-13"><a href="condvsmarg.html#cb156-13" tabindex="-1"></a>wavelength <span class="ot">=</span> <span class="dv">24</span></span>
<span id="cb156-14"><a href="condvsmarg.html#cb156-14" tabindex="-1"></a>n_peak <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb156-15"><a href="condvsmarg.html#cb156-15" tabindex="-1"></a>b0 <span class="ot">=</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb156-16"><a href="condvsmarg.html#cb156-16" tabindex="-1"></a>b1 <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb156-17"><a href="condvsmarg.html#cb156-17" tabindex="-1"></a>b2 <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb156-18"><a href="condvsmarg.html#cb156-18" tabindex="-1"></a>theta0 <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb156-19"><a href="condvsmarg.html#cb156-19" tabindex="-1"></a>theta1 <span class="ot">=</span> <span class="dv">2</span> </span>
<span id="cb156-20"><a href="condvsmarg.html#cb156-20" tabindex="-1"></a>sd_tau <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb156-21"><a href="condvsmarg.html#cb156-21" tabindex="-1"></a>sd_gamma <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb156-22"><a href="condvsmarg.html#cb156-22" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, wavelength, wavelength<span class="sc">/</span><span class="dv">512</span>)</span>
<span id="cb156-23"><a href="condvsmarg.html#cb156-23" tabindex="-1"></a></span>
<span id="cb156-24"><a href="condvsmarg.html#cb156-24" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">sim_activity</span>(<span class="at">M =</span> M, </span>
<span id="cb156-25"><a href="condvsmarg.html#cb156-25" tabindex="-1"></a>                     <span class="at">J =</span> J, </span>
<span id="cb156-26"><a href="condvsmarg.html#cb156-26" tabindex="-1"></a>                     <span class="at">wavelength =</span> wavelength, </span>
<span id="cb156-27"><a href="condvsmarg.html#cb156-27" tabindex="-1"></a>                     <span class="at">n_peak =</span> n_peak, </span>
<span id="cb156-28"><a href="condvsmarg.html#cb156-28" tabindex="-1"></a>                     <span class="at">n_sim =</span> <span class="dv">1</span>, </span>
<span id="cb156-29"><a href="condvsmarg.html#cb156-29" tabindex="-1"></a>                     <span class="at">b0 =</span> <span class="sc">-</span><span class="dv">3</span>, </span>
<span id="cb156-30"><a href="condvsmarg.html#cb156-30" tabindex="-1"></a>                     <span class="at">b0_constant =</span> <span class="cn">TRUE</span>, <span class="co"># common intercept</span></span>
<span id="cb156-31"><a href="condvsmarg.html#cb156-31" tabindex="-1"></a>                     <span class="at">tau_constant =</span> <span class="cn">FALSE</span>, </span>
<span id="cb156-32"><a href="condvsmarg.html#cb156-32" tabindex="-1"></a>                     <span class="at">sdtau =</span> sd_tau, <span class="co"># ~site-specific intercept</span></span>
<span id="cb156-33"><a href="condvsmarg.html#cb156-33" tabindex="-1"></a>                     <span class="at">b1 =</span> b1, </span>
<span id="cb156-34"><a href="condvsmarg.html#cb156-34" tabindex="-1"></a>                     <span class="at">b2 =</span> b2, <span class="co"># amplitude of the cosine terms </span></span>
<span id="cb156-35"><a href="condvsmarg.html#cb156-35" tabindex="-1"></a>                     <span class="at">theta0 =</span> theta0, </span>
<span id="cb156-36"><a href="condvsmarg.html#cb156-36" tabindex="-1"></a>                     <span class="at">theta1 =</span> theta1, <span class="co"># common phaseshifts for the cosine terms</span></span>
<span id="cb156-37"><a href="condvsmarg.html#cb156-37" tabindex="-1"></a>                     <span class="at">phaseshift_constant =</span> <span class="cn">FALSE</span>, </span>
<span id="cb156-38"><a href="condvsmarg.html#cb156-38" tabindex="-1"></a>                     <span class="at">sd_phaseshift =</span> sd_gamma, <span class="co"># site-specific phaseshift (equal for both cosine terms)</span></span>
<span id="cb156-39"><a href="condvsmarg.html#cb156-39" tabindex="-1"></a>                     <span class="at">plot_true_act =</span> <span class="cn">TRUE</span></span>
<span id="cb156-40"><a href="condvsmarg.html#cb156-40" tabindex="-1"></a>                    )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:condvsmarg1"></span>
<img src="HMsActivity_files/figure-html/condvsmarg1-1.png" alt="Conditional activity pattern for a typical site (one with random effects equal to zero) and marginal mean activity pattern formed by averaging site-specific activity patterns across a population of sites." width="672" />
<p class="caption">
Figure 8.1: Conditional activity pattern for a typical site (one with random effects equal to zero) and marginal mean activity pattern formed by averaging site-specific activity patterns across a population of sites.
</p>
</div>
<div id="estimating-conditional-and-marginal-mean-activity-patterns" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Estimating conditional and marginal mean activity patterns<a href="condvsmarg.html#estimating-conditional-and-marginal-mean-activity-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before fitting models, we need to prepare the data. We use the code from Tutorial <a href="est.html#est">3</a> to aggregate the data by site, resulting in a data set with the following variables:</p>
<ul>
<li><code>Site</code> = ID for each surveyed site</li>
<li><code>Time</code> = hour of day</li>
<li><code>success</code> = number of encounters at the particular <code>Site</code> and <code>Time</code></li>
<li><code>n_events</code> = number of observation intervals associated with the particular <code>Site</code> and <code>Time</code></li>
<li><code>failure</code> = number of observation intervals without an encounters at the particular <code>Site</code> and <code>Time</code></li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="condvsmarg.html#cb157-1" tabindex="-1"></a><span class="co"># The data</span></span>
<span id="cb157-2"><a href="condvsmarg.html#cb157-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dat<span class="sc">$</span>sim_data)</span>
<span id="cb157-3"><a href="condvsmarg.html#cb157-3" tabindex="-1"></a></span>
<span id="cb157-4"><a href="condvsmarg.html#cb157-4" tabindex="-1"></a><span class="co"># summarize aggregated data</span></span>
<span id="cb157-5"><a href="condvsmarg.html#cb157-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="fu">paste</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,M,<span class="dv">1</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>), </span>
<span id="cb157-6"><a href="condvsmarg.html#cb157-6" tabindex="-1"></a>                <span class="at">y=</span><span class="fu">as.data.frame</span>(y)</span>
<span id="cb157-7"><a href="condvsmarg.html#cb157-7" tabindex="-1"></a>                )</span>
<span id="cb157-8"><a href="condvsmarg.html#cb157-8" tabindex="-1"></a><span class="fu">colnames</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, </span>
<span id="cb157-9"><a href="condvsmarg.html#cb157-9" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">&quot;S&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(y)<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb157-10"><a href="condvsmarg.html#cb157-10" tabindex="-1"></a>                 )</span>
<span id="cb157-11"><a href="condvsmarg.html#cb157-11" tabindex="-1"></a></span>
<span id="cb157-12"><a href="condvsmarg.html#cb157-12" tabindex="-1"></a><span class="co"># Format data in long format</span></span>
<span id="cb157-13"><a href="condvsmarg.html#cb157-13" tabindex="-1"></a>y_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> y, <span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-14"><a href="condvsmarg.html#cb157-14" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">time=</span><span class="fu">as.numeric</span>(<span class="fu">substr</span>(time,<span class="dv">2</span>,<span class="dv">10</span>)),</span>
<span id="cb157-15"><a href="condvsmarg.html#cb157-15" tabindex="-1"></a>                       <span class="at">id =</span> <span class="fu">factor</span>(id)</span>
<span id="cb157-16"><a href="condvsmarg.html#cb157-16" tabindex="-1"></a>                       )</span>
<span id="cb157-17"><a href="condvsmarg.html#cb157-17" tabindex="-1"></a></span>
<span id="cb157-18"><a href="condvsmarg.html#cb157-18" tabindex="-1"></a><span class="co"># create variable to describe time as hour (between 0 and 23)</span></span>
<span id="cb157-19"><a href="condvsmarg.html#cb157-19" tabindex="-1"></a>y_long<span class="sc">$</span>hour <span class="ot">&lt;-</span> <span class="fu">sim_to_minute</span>(y_long<span class="sc">$</span>time, <span class="at">group =</span> wavelength)</span>
<span id="cb157-20"><a href="condvsmarg.html#cb157-20" tabindex="-1"></a></span>
<span id="cb157-21"><a href="condvsmarg.html#cb157-21" tabindex="-1"></a><span class="co"># count successes and failures at each site-occasion</span></span>
<span id="cb157-22"><a href="condvsmarg.html#cb157-22" tabindex="-1"></a>occasions_cbind <span class="ot">&lt;-</span> y_long <span class="sc">%&gt;%</span> </span>
<span id="cb157-23"><a href="condvsmarg.html#cb157-23" tabindex="-1"></a>  <span class="fu">group_by</span>(id, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb157-24"><a href="condvsmarg.html#cb157-24" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">success =</span> <span class="fu">sum</span>(y),</span>
<span id="cb157-25"><a href="condvsmarg.html#cb157-25" tabindex="-1"></a>            <span class="at">n_events =</span> <span class="fu">n</span>(),</span>
<span id="cb157-26"><a href="condvsmarg.html#cb157-26" tabindex="-1"></a>            <span class="at">failure =</span> n_events <span class="sc">-</span> success</span>
<span id="cb157-27"><a href="condvsmarg.html#cb157-27" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb157-28"><a href="condvsmarg.html#cb157-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Site =</span> id,</span>
<span id="cb157-29"><a href="condvsmarg.html#cb157-29" tabindex="-1"></a>               <span class="at">Time =</span> hour</span>
<span id="cb157-30"><a href="condvsmarg.html#cb157-30" tabindex="-1"></a>               )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;id&#39;. You can override using the `.groups` argument.</code></pre>
<p>We are now ready to estimate conditional and marginal mean activity in the frequentist framework.</p>
</div>
<div id="the-frequentist-framework" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> The frequentist framework<a href="condvsmarg.html#the-frequentist-framework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When using <strong>trigonometric GLMMs</strong>, we can quantify the conditional mean by setting all the random effects in the GLMM as equal to 0 and the marginal mean by integrating over the distribution of the random effects <span class="citation">(<a href="references.html#ref-Fieberg_ea_2009">Fieberg et al. 2009</a>)</span>. Among the many packages available in R to model GLMMs, GLMMadaptive <span class="citation">(<a href="references.html#ref-Rizopoulos2022">Rizopoulos 2022</a>)</span> has the advantage of providing estimates of parameters describing both conditional and marginal mean response curves.</p>
<p>We start by fitting the model, similar to how we have done it in previous sections of these tutorials.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="condvsmarg.html#cb159-1" tabindex="-1"></a><span class="co"># Modelling activity pattern using trigonometric GLMMs in the parametric modelling framework</span></span>
<span id="cb159-2"><a href="condvsmarg.html#cb159-2" tabindex="-1"></a>trig_rand_slope <span class="ot">&lt;-</span> <span class="fu">mixed_model</span>(<span class="at">fixed =</span> <span class="fu">cbind</span>(success, failure) <span class="sc">~</span> </span>
<span id="cb159-3"><a href="condvsmarg.html#cb159-3" tabindex="-1"></a>                                 <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb159-4"><a href="condvsmarg.html#cb159-4" tabindex="-1"></a>                                 <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>),</span>
<span id="cb159-5"><a href="condvsmarg.html#cb159-5" tabindex="-1"></a>                               <span class="at">random =</span> <span class="sc">~</span>  <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb159-6"><a href="condvsmarg.html#cb159-6" tabindex="-1"></a>                                 <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> Time<span class="sc">/</span><span class="dv">12</span>)  <span class="sc">||</span>   Site,</span>
<span id="cb159-7"><a href="condvsmarg.html#cb159-7" tabindex="-1"></a>                               <span class="at">data =</span> occasions_cbind, </span>
<span id="cb159-8"><a href="condvsmarg.html#cb159-8" tabindex="-1"></a>                               <span class="at">family =</span> <span class="fu">binomial</span>(), </span>
<span id="cb159-9"><a href="condvsmarg.html#cb159-9" tabindex="-1"></a>                               <span class="at">iter_EM =</span> <span class="dv">0</span></span>
<span id="cb159-10"><a href="condvsmarg.html#cb159-10" tabindex="-1"></a>                               )</span>
<span id="cb159-11"><a href="condvsmarg.html#cb159-11" tabindex="-1"></a></span>
<span id="cb159-12"><a href="condvsmarg.html#cb159-12" tabindex="-1"></a><span class="fu">summary</span>(trig_rand_slope)</span></code></pre></div>
<pre><code>## 
## Call:
## mixed_model(fixed = cbind(success, failure) ~ cos(2 * pi * Time/24) + 
##     sin(2 * pi * Time/24) + cos(2 * pi * Time/12) + sin(2 * pi * 
##     Time/12), random = ~cos(2 * pi * Time/24) + sin(2 * pi * 
##     Time/24) + cos(2 * pi * Time/12) + sin(2 * pi * Time/12) || 
##     Site, data = occasions_cbind, family = binomial(), iter_EM = 0)
## 
## Data Descriptives:
## Number of Observations: 2400
## Number of Groups: 100 
## 
## Model:
##  family: binomial
##  link: logit 
## 
## Fit statistics:
##    log.Lik      AIC      BIC
##  -3704.187 7428.374 7454.425
## 
## Random effects covariance matrix:
##                       StdDev
## (Intercept)           0.9742
## cos(2 * pi * Time/24) 0.0307
## sin(2 * pi * Time/24) 0.2343
## cos(2 * pi * Time/12) 0.1913
## sin(2 * pi * Time/12) 0.0430
## 
## Fixed effects:
##                       Estimate Std.Err  z-value p-value
## (Intercept)            -3.0888  0.1000 -30.8945 &lt; 1e-04
## cos(2 * pi * Time/24)  -0.9410  0.0268 -35.1529 &lt; 1e-04
## sin(2 * pi * Time/24)  -0.1584  0.0345  -4.5927 &lt; 1e-04
## cos(2 * pi * Time/12)  -0.2659  0.0315  -8.4323 &lt; 1e-04
## sin(2 * pi * Time/12)  -0.5988  0.0237 -25.2223 &lt; 1e-04
## 
## Integration:
## method: adaptive Gauss-Hermite quadrature rule
## quadrature points: 7
## 
## Optimization:
## method: quasi-Newton
## converged: TRUE</code></pre>
<p>In most of the applications so far (except Tutorial <a href="temppart.html#temppart">7</a>), we explored the model results using the predicted conditional mean activity patterns. We calculated these patterns using the function <code>effectPlotData</code>, which is included in the <code>GLMMadaptive</code> package, by setting the argument <code>marginal</code> as equal <code>FALSE</code>. We do the same here. The conditional mean can be easily estimated using other packages available in R to fit GLMMs by setting the random effect equal to 0 and then predict the activity pattern over the 24-hour cycle. For example, we can use the <code>predict</code> function with the argument <code>re.form = NA</code> to obtain conditional means when models are fit using the <code>glmer</code> function in the <code>lme4</code> package <span class="citation">(<a href="references.html#ref-lme4">Bates et al. 2015</a>)</span>.</p>
<p>We can estimate marginal means using numerical integration (as done in Tutorial <a href="var.html#var">2</a>), simulation, or using various approximation methods <span class="citation">(see e.g., section 19.2 of <a href="references.html#ref-fieberg2024">Fieberg 2024</a>)</span>. The primary reason we explore <code>mixed_model</code> in the <code>GLMMadaptive</code> package is because it does the hard work for us. To calculate the predicted marginal mean activity pattern, we only need to change the argument <code>marginal</code> from <code>FALSE</code> to <code>TRUE</code> in the <code>effectPlotData</code> function.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="condvsmarg.html#cb161-1" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">with</span>(occasions_cbind, </span>
<span id="cb161-2"><a href="condvsmarg.html#cb161-2" tabindex="-1"></a>               <span class="fu">expand.grid</span>(<span class="at">Time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(Time), <span class="dv">24</span>, <span class="at">length.out =</span> <span class="dv">48</span>))</span>
<span id="cb161-3"><a href="condvsmarg.html#cb161-3" tabindex="-1"></a>               )</span>
<span id="cb161-4"><a href="condvsmarg.html#cb161-4" tabindex="-1"></a>cond_eff <span class="ot">&lt;-</span> <span class="fu">effectPlotData</span>(trig_rand_slope, newdat, <span class="at">marginal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-5"><a href="condvsmarg.html#cb161-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">plogis</span>(pred),</span>
<span id="cb161-6"><a href="condvsmarg.html#cb161-6" tabindex="-1"></a>         <span class="at">low =</span> <span class="fu">plogis</span>(low),</span>
<span id="cb161-7"><a href="condvsmarg.html#cb161-7" tabindex="-1"></a>         <span class="at">upp =</span> <span class="fu">plogis</span>(upp),</span>
<span id="cb161-8"><a href="condvsmarg.html#cb161-8" tabindex="-1"></a>         <span class="at">Method =</span> <span class="st">&quot;effectPlotData&quot;</span>,</span>
<span id="cb161-9"><a href="condvsmarg.html#cb161-9" tabindex="-1"></a>         <span class="at">Mean =</span> <span class="st">&quot;Conditional&quot;</span></span>
<span id="cb161-10"><a href="condvsmarg.html#cb161-10" tabindex="-1"></a>         )</span>
<span id="cb161-11"><a href="condvsmarg.html#cb161-11" tabindex="-1"></a></span>
<span id="cb161-12"><a href="condvsmarg.html#cb161-12" tabindex="-1"></a>marg_eff <span class="ot">&lt;-</span> <span class="fu">effectPlotData</span>(trig_rand_slope, newdat, <span class="at">marginal =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-13"><a href="condvsmarg.html#cb161-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">plogis</span>(pred),</span>
<span id="cb161-14"><a href="condvsmarg.html#cb161-14" tabindex="-1"></a>         <span class="at">low =</span> <span class="fu">plogis</span>(low),</span>
<span id="cb161-15"><a href="condvsmarg.html#cb161-15" tabindex="-1"></a>         <span class="at">upp =</span> <span class="fu">plogis</span>(upp),</span>
<span id="cb161-16"><a href="condvsmarg.html#cb161-16" tabindex="-1"></a>         <span class="at">Method =</span> <span class="st">&quot;effectPlotData&quot;</span>,</span>
<span id="cb161-17"><a href="condvsmarg.html#cb161-17" tabindex="-1"></a>         <span class="at">Mean =</span> <span class="st">&quot;Marginal&quot;</span></span>
<span id="cb161-18"><a href="condvsmarg.html#cb161-18" tabindex="-1"></a>         )</span></code></pre></div>
<p>It is also possible to calculate both means using the estimated coefficients extracted directly from the fitted model. In this case, we can obtain estimates of the marginal coefficients that approximate the curve formed by integrating over the random effects using the <code>marginal_coefs</code> function in the <code>GLMMadaptive</code> package, which uses a numerical approximation based on an adaptive Gauss-Hermite quadrature rule <span class="citation">(<a href="references.html#ref-Hedeker_ea_2018">Hedeker et al. 2018</a>)</span> to calculate these values. From the parameter estimates, we can calculate the predicted conditional and marginal activity curves using the appropriate coefficient values along with the following equation:</p>
<p><span class="math display">\[
\text{logit}(p_t) = \hat{\beta_0} + \hat{\alpha_1}*\text{cos}(\frac{2\pi t}{24}) + \hat{\alpha_2}*\text{sin}(\frac{2\pi t}{24}) + \hat{\alpha_3}*\text{cos}(\frac{2\pi t}{12}) + \hat{\alpha_4}*\text{sin}(\frac{2\pi t}{12})
\]</span></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="condvsmarg.html#cb162-1" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">t</span>(GLMMadaptive<span class="sc">::</span><span class="fu">fixef</span>(trig_rand_slope)), </span>
<span id="cb162-2"><a href="condvsmarg.html#cb162-2" tabindex="-1"></a>                  <span class="fu">t</span>(GLMMadaptive<span class="sc">::</span><span class="fu">marginal_coefs</span>(trig_rand_slope, <span class="at">std_errors =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>betas)</span>
<span id="cb162-3"><a href="condvsmarg.html#cb162-3" tabindex="-1"></a>                  ), </span>
<span id="cb162-4"><a href="condvsmarg.html#cb162-4" tabindex="-1"></a>                  <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb162-5"><a href="condvsmarg.html#cb162-5" tabindex="-1"></a>                )</span>
<span id="cb162-6"><a href="condvsmarg.html#cb162-6" tabindex="-1"></a><span class="fu">colnames</span>(betas) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(<span class="fu">t</span>(GLMMadaptive<span class="sc">::</span><span class="fu">fixef</span>(trig_rand_slope)))</span>
<span id="cb162-7"><a href="condvsmarg.html#cb162-7" tabindex="-1"></a><span class="fu">rownames</span>(betas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Conditional&quot;</span>, <span class="st">&quot;Marginal&quot;</span>)</span>
<span id="cb162-8"><a href="condvsmarg.html#cb162-8" tabindex="-1"></a></span>
<span id="cb162-9"><a href="condvsmarg.html#cb162-9" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(betas) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">GLMM =</span> <span class="st">&quot;Rand_Intercept_and_Slope&quot;</span>)</span>
<span id="cb162-10"><a href="condvsmarg.html#cb162-10" tabindex="-1"></a></span>
<span id="cb162-11"><a href="condvsmarg.html#cb162-11" tabindex="-1"></a>cond <span class="ot">&lt;-</span> <span class="fu">plogis</span>(betas[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb162-12"><a href="condvsmarg.html#cb162-12" tabindex="-1"></a>               betas[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb162-13"><a href="condvsmarg.html#cb162-13" tabindex="-1"></a>               betas[<span class="dv">1</span>,<span class="dv">3</span>] <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb162-14"><a href="condvsmarg.html#cb162-14" tabindex="-1"></a>               betas[<span class="dv">1</span>,<span class="dv">4</span>] <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb162-15"><a href="condvsmarg.html#cb162-15" tabindex="-1"></a>               betas[<span class="dv">1</span>,<span class="dv">5</span>] <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb162-16"><a href="condvsmarg.html#cb162-16" tabindex="-1"></a>               )</span>
<span id="cb162-17"><a href="condvsmarg.html#cb162-17" tabindex="-1"></a>phat_cond <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> time,</span>
<span id="cb162-18"><a href="condvsmarg.html#cb162-18" tabindex="-1"></a>                        <span class="at">pred =</span> cond,</span>
<span id="cb162-19"><a href="condvsmarg.html#cb162-19" tabindex="-1"></a>                        <span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb162-20"><a href="condvsmarg.html#cb162-20" tabindex="-1"></a>                        <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb162-21"><a href="condvsmarg.html#cb162-21" tabindex="-1"></a>                        <span class="at">Method =</span> <span class="st">&quot;coeff. estimates&quot;</span>,</span>
<span id="cb162-22"><a href="condvsmarg.html#cb162-22" tabindex="-1"></a>                        <span class="at">Mean =</span> <span class="st">&quot;Conditional&quot;</span></span>
<span id="cb162-23"><a href="condvsmarg.html#cb162-23" tabindex="-1"></a>                        )</span>
<span id="cb162-24"><a href="condvsmarg.html#cb162-24" tabindex="-1"></a></span>
<span id="cb162-25"><a href="condvsmarg.html#cb162-25" tabindex="-1"></a>marg <span class="ot">&lt;-</span> <span class="fu">plogis</span>(betas[<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb162-26"><a href="condvsmarg.html#cb162-26" tabindex="-1"></a>               betas[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb162-27"><a href="condvsmarg.html#cb162-27" tabindex="-1"></a>               betas[<span class="dv">2</span>,<span class="dv">3</span>] <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">24</span>)<span class="sc">+</span></span>
<span id="cb162-28"><a href="condvsmarg.html#cb162-28" tabindex="-1"></a>               betas[<span class="dv">2</span>,<span class="dv">4</span>] <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb162-29"><a href="condvsmarg.html#cb162-29" tabindex="-1"></a>               betas[<span class="dv">2</span>,<span class="dv">5</span>] <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>time<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb162-30"><a href="condvsmarg.html#cb162-30" tabindex="-1"></a>               )</span>
<span id="cb162-31"><a href="condvsmarg.html#cb162-31" tabindex="-1"></a>phat_marg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> time,</span>
<span id="cb162-32"><a href="condvsmarg.html#cb162-32" tabindex="-1"></a>                        <span class="at">pred =</span> marg,</span>
<span id="cb162-33"><a href="condvsmarg.html#cb162-33" tabindex="-1"></a>                        <span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb162-34"><a href="condvsmarg.html#cb162-34" tabindex="-1"></a>                        <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb162-35"><a href="condvsmarg.html#cb162-35" tabindex="-1"></a>                        <span class="at">Method =</span> <span class="st">&quot;coeff. estimates&quot;</span>,</span>
<span id="cb162-36"><a href="condvsmarg.html#cb162-36" tabindex="-1"></a>                        <span class="at">Mean =</span> <span class="st">&quot;Marginal&quot;</span></span>
<span id="cb162-37"><a href="condvsmarg.html#cb162-37" tabindex="-1"></a>                        )</span></code></pre></div>
<p>We visually compare the estimates returned by both methods, and the two estimates to the true conditional and marginal activity patterns used to simulate the data.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="condvsmarg.html#cb163-1" tabindex="-1"></a><span class="co"># extract true conditional and marginal patterns</span></span>
<span id="cb163-2"><a href="condvsmarg.html#cb163-2" tabindex="-1"></a>cond_true <span class="ot">&lt;-</span> dat<span class="sc">$</span>Conditional <span class="sc">%&gt;%</span> </span>
<span id="cb163-3"><a href="condvsmarg.html#cb163-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb163-4"><a href="condvsmarg.html#cb163-4" tabindex="-1"></a>         <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb163-5"><a href="condvsmarg.html#cb163-5" tabindex="-1"></a>         <span class="at">Method =</span> <span class="st">&quot;True pattern&quot;</span>,</span>
<span id="cb163-6"><a href="condvsmarg.html#cb163-6" tabindex="-1"></a>         <span class="at">Mean =</span> <span class="st">&quot;Conditional&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb163-7"><a href="condvsmarg.html#cb163-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Time =</span> time, <span class="at">pred =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb163-8"><a href="condvsmarg.html#cb163-8" tabindex="-1"></a>  <span class="fu">select</span>(Time, pred, low, upp, Method, Mean)</span>
<span id="cb163-9"><a href="condvsmarg.html#cb163-9" tabindex="-1"></a></span>
<span id="cb163-10"><a href="condvsmarg.html#cb163-10" tabindex="-1"></a>marg_true <span class="ot">&lt;-</span> dat<span class="sc">$</span>Marginal <span class="sc">%&gt;%</span> </span>
<span id="cb163-11"><a href="condvsmarg.html#cb163-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">low =</span> <span class="cn">NA</span>,</span>
<span id="cb163-12"><a href="condvsmarg.html#cb163-12" tabindex="-1"></a>         <span class="at">upp =</span> <span class="cn">NA</span>,</span>
<span id="cb163-13"><a href="condvsmarg.html#cb163-13" tabindex="-1"></a>         <span class="at">Method =</span> <span class="st">&quot;True pattern&quot;</span>,</span>
<span id="cb163-14"><a href="condvsmarg.html#cb163-14" tabindex="-1"></a>         <span class="at">Mean =</span> <span class="st">&quot;Marginal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb163-15"><a href="condvsmarg.html#cb163-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Time =</span> time, <span class="at">pred =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb163-16"><a href="condvsmarg.html#cb163-16" tabindex="-1"></a>  <span class="fu">select</span>(Time, pred, low, upp, Method, Mean)</span>
<span id="cb163-17"><a href="condvsmarg.html#cb163-17" tabindex="-1"></a></span>
<span id="cb163-18"><a href="condvsmarg.html#cb163-18" tabindex="-1"></a><span class="co"># bring all the information together in one dataset</span></span>
<span id="cb163-19"><a href="condvsmarg.html#cb163-19" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cond_true, marg_true, cond_eff, marg_eff, phat_cond, phat_marg)</span></code></pre></div>
<div class="sourceCode" id="cb164"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb164-1"><a href="condvsmarg.html#cb164-1" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y=</span> pred, <span class="at">col =</span> Method)) <span class="sc">+</span></span>
<span id="cb164-2"><a href="condvsmarg.html#cb164-2" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, <span class="at">fill =</span> Method), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb164-3"><a href="condvsmarg.html#cb164-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb164-4"><a href="condvsmarg.html#cb164-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of Day (Hour)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Activity Pattern </span><span class="sc">\n</span><span class="st"> (probability)&quot;</span>)<span class="sc">+</span></span>
<span id="cb164-5"><a href="condvsmarg.html#cb164-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb164-6"><a href="condvsmarg.html#cb164-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb164-7"><a href="condvsmarg.html#cb164-7" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-8"><a href="condvsmarg.html#cb164-8" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb164-9"><a href="condvsmarg.html#cb164-9" tabindex="-1"></a>        <span class="at">legend.margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb164-10"><a href="condvsmarg.html#cb164-10" tabindex="-1"></a>        <span class="at">legend.box.margin=</span><span class="fu">margin</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>,<span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb164-11"><a href="condvsmarg.html#cb164-11" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb164-12"><a href="condvsmarg.html#cb164-12" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb164-13"><a href="condvsmarg.html#cb164-13" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;solid&#39;</span>),</span>
<span id="cb164-14"><a href="condvsmarg.html#cb164-14" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb164-15"><a href="condvsmarg.html#cb164-15" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-16"><a href="condvsmarg.html#cb164-16" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-17"><a href="condvsmarg.html#cb164-17" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&#39;lightgrey&#39;</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>),</span>
<span id="cb164-18"><a href="condvsmarg.html#cb164-18" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-19"><a href="condvsmarg.html#cb164-19" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb164-20"><a href="condvsmarg.html#cb164-20" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb164-21"><a href="condvsmarg.html#cb164-21" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb164-22"><a href="condvsmarg.html#cb164-22" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="at">length.out=</span><span class="dv">7</span>), <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb164-23"><a href="condvsmarg.html#cb164-23" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Mean) </span></code></pre></div>
<pre><code>## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf
## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf
## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf
## Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -Inf</code></pre>
<div class="figure"><span style="display:block;" id="fig:condvsmarg6n"></span>
<img src="HMsActivity_files/figure-html/condvsmarg6n-1.png" alt="Comparison of marginal and conditional activity curves produced two ways along with true values used to simulate data." width="672" />
<p class="caption">
Figure 8.2: Comparison of marginal and conditional activity curves produced two ways along with true values used to simulate data.
</p>
</div>
<p>The mean activity patterns returned by the <code>effectDataPlot</code> function and by the manual calculation match perfectly and both closely track the true, simulated conditional and marginal activity curves. The choice of which of the two predictive methods to use depends on the complexity of the fitted model. The <code>effectDataPlot</code> function can require long times to return a prediction when a random slope is included.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="temppart.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="kdes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
