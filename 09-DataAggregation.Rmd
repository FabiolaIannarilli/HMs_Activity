# Aggregating camera trap data to reduce short-term temporal correlation {#dataaggr}

Building on the previous chapter, here, we illustrate with a specific example the effect that aggregating data for reducing short-time correlation has on estimates of activity curves. As in the previous chapter, we use camera-trap data of American black bears (_Ursus americanus_) collected in northern-Minnesota between mid-May and mid-July 2017.

In \@ref(kdes), the estimates were all calculated after aggregating the data in events (i.e., group of pictures taken at the same location within a short time frame). This aggregation is usually applied to minimize temporal autocorrelation among records capture at a certain location. To illustrate the consequences of non aggregating the data, we now re-run the same code as in \@ref(kdes), this time using all the original records.

## Estimating activity

```{r aggr1, message = FALSE, warnings = FALSE}

# Specify the format of the column Time
dat$Time <- hms(dat$Time) 

# Convert time values to radians
dat$Time_Rad <- (hour(dat$Time)*60 + minute(dat$Time))/(60*24)*2*pi 



# OVERLAP
# To avoid plotting
pdf(file = NULL) 

# Estimate activity patterns and store values in an object 
res_over_NonAggr <- densityPlot(dat$Time_Rad, rug = FALSE, adjust = 1, xscale = 24*60, n.grid = 513, extend = NULL) %>% 
  mutate(se = NA,
         Package = "Overlap", 
         Data = "Non-Aggregated") 
dev.off()

# ACTIVITY
# Estimate activity patterns and store values in an object 
res_acti_NonAggr <- as.data.frame(fitact(dat$Time_Rad, reps = 999, sample = "data", show = FALSE)@pdf[,1:3]) %>% 
  mutate(x = x/(2*pi)*24*60, # to bring results back to the minute scale,
         Package = "Activity", 
         Data = "Non-Aggregated") 

# CIRCULAR
# prepare the specific format required by circular
dat$Time_Rad_circ <- as.circular(dat$Time_Rad, units = "radians",
template = "none", zero=0, type="angles", modulo = "2pi",
rotation="counter")

# determine bandwidth
bw1 <- bw.cv.ml.circular(dat$Time_Rad_circ, kernel = "vonmises") 

# estimate activity patterns
temp1 <- modal.region.circular(dat$Time_Rad_circ, kernel = "vonmises", q = 0.5, adjust = 1, bw = bw1) 

# organize the output in a datafram to match those of the other packages
res_circ_NonAggr <- data.frame(x=temp1$density$x, 
                       y=temp1$density$y) %>% 
                mutate(x = x/(2*pi)*24*60, # to bring results back to the minute scale,
                       se = NA, 
                       Package = "Circular", 
         Data = "Non-Aggregated")

res_area3 <- res_circ_NonAggr %>% filter(x>temp1$zeros[1,1]/(2*pi)*24*60 & x<temp1$zeros[1,2]/(2*pi)*24*60)
res_area4 <- res_circ_NonAggr %>% filter(x>temp1$zeros[2,1]/(2*pi)*24*60 & x<temp1$zeros[2,2]/(2*pi)*24*60)


```
## Joining the results and plotting

We now plot the results based on the aggregated and non-aggregated data and visually compare them.

```{r aggr2, fig.cap='Activity patterns based on Kernel Density Estimates of American black bear camera-trap data collected in northern-Minnesota between mid-May and mid-July 2017. Estimates were obtained using R-package: A) overlap (Ridout and Linkie 2009); B) activity (Rowcliffe et al. 2014); C) circular (Agostinelli and Lund 2017). Non-aggregated data included all photographic records; in the aggregated data, we removed records less than 30 minutes apart to minimize short-term correlation in detection due to animals lingering in front of the cameras. Lines represent mean estimates. Shaded areas represent 95% confidence intervals in B, and activity range cores (50% isopleth) in C.', out.width='100%', fig.asp=.75, fig.align='center'}

# plot OVERLAP
# Join results and plot
res_over_both <- rbind(res_over, res_over_NonAggr) 
pl_over <- ggplot(res_over_both, aes(x=x, y=y, group=Data)) +
  geom_line(aes(linetype=Data, color=Data), size=1) +
  scale_color_manual(values = c("#CC79A7", "#0072B2")) +
  labs(x = "", y = "Density", title = "A: Overlap pkg") +
  theme_minimal() +
  theme(legend.position = "none",
        legend.background = element_rect(fill = "white", colour = "black"),
        legend.title = element_text(size=8,face="bold"),
        axis.line = element_line(colour = 'black', linetype = 'solid'),
        axis.ticks = element_line(colour = 'black', linetype = 'solid'),
        #axis.title.y = element_blank(),
        axis.text = element_text(size=8),
        axis.title.y = element_text(size=10,face="bold"),
        axis.title.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_line(colour = 'lightgrey', linetype = 'dashed', size=0.5),#element_line(colour = 'grey', linetype = 'solid', size=0.5),
        panel.grid.minor.x = element_blank(),
        strip.text = element_text(size = 10, colour = "black", face = "bold")) +
  scale_x_continuous(breaks=seq(0,24*60,60*4), labels=seq(0,24,4), expand = expand_scale(mult = c(0.02,0.02)))+
  scale_y_continuous(expand = expand_scale(mult = c(0.02, 0.02)))

# plot ACTIVITY
res_acti_both <- rbind(res_acti, res_acti_NonAggr)
pl_acti <- ggplot(res_acti_both, aes(x=x, y=y, group=Data)) +
  geom_ribbon(aes(ymin=y-1.96*se, ymax=y+1.96*se, color=Data, fill=Data), alpha=0.3) +
  geom_line(aes(linetype=Data, color=Data), size=1) +
  scale_color_manual(values = c("#CC79A7", "#0072B2")) +
  scale_fill_manual(values = c("#CC79A7", "#0072B2")) +
  labs(x = "", y = "Activity density", title = "B: Activity pkg") +
  coord_cartesian(ylim = c(0,0.4)) +
  theme_minimal() +
  theme(legend.position = "none",
        axis.line = element_line(colour = 'black', linetype = 'solid'),
        axis.ticks = element_line(colour = 'black', linetype = 'solid'),
        #axis.title.y = element_blank(),
        axis.text = element_text(size=8),
        axis.title.y = element_text(size=10,face="bold"),
        axis.title.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_line(colour = 'lightgrey', linetype = 'dashed', size=0.5),#element_line(colour = 'grey', linetype = 'solid', size=0.5),
        panel.grid.minor.x = element_blank(),
        strip.text = element_text(size = 10, colour = "black", face = "bold")) +
  scale_x_continuous(breaks=seq(0,24*60,60*4), labels=seq(0,24,4), expand = expand_scale(mult = c(0.02,0.02)))+
  scale_y_continuous(expand = expand_scale(mult = c(0.02, 0.02)))

# plot CIRCULAR
res_circ_both <- rbind(res_circ, res_circ_NonAggr) 
pl_circ <- ggplot(res_circ_both, aes(x=x, y=y, group=Data)) +
  geom_line(aes(linetype=Data, color=Data), size=1) +
  geom_area(data=res_area1, aes(x=x, y=y), col="#CC79A7", fill="#CC79A7", alpha=0.3) +
  geom_area(data=res_area2, aes(x=x, y=y), col="#CC79A7", fill="#CC79A7", alpha=0.3) +
  geom_area(data=res_area3, aes(x=x, y=y), col="#0072B2", fill="#0072B2", alpha=0.3) +
  geom_area(data=res_area4, aes(x=x, y=y), col="#0072B2", fill="#0072B2", alpha=0.3) +
  scale_color_manual(values = c("#CC79A7", "#0072B2")) +
  labs(x = "", y = "Kernel Density Estimate", title = "C: Circular pkg") +
  coord_cartesian(ylim = c(0,0.4)) +
  theme_minimal() +
  theme(legend.position = c(0.25, 0.9),
        axis.line = element_line(colour = 'black', linetype = 'solid'),
        axis.ticks = element_line(colour = 'black', linetype = 'solid'),
        #axis.title.y = element_blank(),
        axis.text = element_text(size=8),
        axis.title.y = element_text(size=10,face="bold"),
        axis.title.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_line(colour = 'lightgrey', linetype = 'dashed', size=0.5),#element_line(colour = 'grey', linetype = 'solid', size=0.5),
        panel.grid.minor.x = element_blank(),
        strip.text = element_text(size = 10, colour = "black", face = "bold")) +
  scale_x_continuous(breaks=seq(0,24*60,60*4), labels=seq(0,24,4), expand = expand_scale(mult = c(0.02,0.02)))+
  scale_y_continuous(expand = expand_scale(mult = c(0.02, 0.02)))

#' Combine results of the 3 methods
(pl_both <- grid.arrange(pl_over, pl_acti, pl_circ, nrow = 1, bottom=textGrob("Time of day (Hour)", gp=gpar(fontsize=10, fontface="bold")),
                    top = textGrob("KDE-based estimates of activity patterns using:",gp=gpar(fontsize=20,font=3))))
```


This comparison shows that non-aggregating the data leads to estimates of activity curves that are extremely wiggly. This could make the interpretation of the results particularly challenging and even lead to biased conclusions when results are driven by one or two individuals staying in front of a camera for an extensive amount of time (but see @Parcelea2022 for a different perspective on this topic).

